# ドメイン理解ドキュメント作成ガイド

## 目的

仕様書や要件定義からDDD設計に必要なドメイン知識を体系的に抽出・整理し、厳密な仕様化とユビキタス言語確立を実現するための実用的なガイドを提供する。

## 前提条件

- プロジェクトの基本仕様書・要件定義が存在すること
- DDD（ドメイン駆動設計）の基本概念を理解していること
- ドメインエキスパートとの対話機会が設定できること

## アプローチ：質問駆動反復方式

### 基本方針

**段階的理解向上**: 初期分析→質問生成→回答→理解更新を複数サイクル反復し、理解度を段階的に高める

- 各サイクルで**進捗・理解度・残存疑問・新規発見**を明記
- **仕様の厳密化とトレーサビリティ**を両立
- サイクルごとにナレッジ（現状理解）と質問事項（未解決点）を分離
- 完了条件は**主要ドメイン概念の理解度80%以上**

## 必須ドキュメント構成

### 1. 情報源一覧と分析順序

**目的**: 分析対象の全体把握と作業計画

**フォーマット**:

```markdown
| ドキュメント | 読了状況 | 抽出概念数 | 疑問点数 | 備考 |
|------------|----------|-----------|----------|------|
| [ファイルパス] | ✅/⏳ | [数] | [数] | [追加情報] |
```

**実施要領**:

- 仕様・技術スタック・要件等の情報源を優先度順にリストアップ
- 各ドキュメントの読了状況・抽出概念数・疑問点数を逐次更新
- 分析順序と理由を明記

### 2. 概念理解マトリックス

**目的**: 主要ドメイン概念の理解状況を一元管理

**フォーマット**:

```markdown
| 概念 | エビデンス | ビジネスルール | 用語定義(日/英) | 理解度 | 残存質問 | 現状解釈・進捗コメント |
|------|-----------|---------------|----------------|-------|----------|---------------------|
| [概念名] | [参照先] | [ルール] | [定義] | [%] | [質問] | [コメント] |
```

**記入ルール**:

- **エビデンス**: 情報源の具体的参照先（ファイル#行番号）
- **理解度**: 0-100%で客観的に評価
- **残存質問**: 具体的で回答可能な質問形式
- **進捗コメント**: サイクルごとの変化を記録

### 3. ビジネスルール詳細マトリックス

**目的**: ビジネス制約と例外処理の厳密化

**フォーマット**:

```markdown
| ルール名 | エビデンス | 制約条件 | 例外条件 | 実装影響 | 不明点・質問 |
|----------|-----------|----------|----------|----------|-------------|
| [ルール名] | [参照先] | [条件] | [例外] | [影響] | [質問] |
```

**記入要領**:

- **制約条件**: 必須・任意・禁止事項を明確化
- **例外条件**: 正常系以外の処理パターン
- **実装影響**: アーキテクチャ・API・DB設計への制約
- **不明点**: ドメインエキスパートへの確認事項

### 4. 用語統一マトリックス（ユビキタス言語候補）

**目的**: ドメイン共通語の厳密定義とBDD連携

**フォーマット**:

```markdown
| 日本語 | 英語 | エビデンス | 定義 | 用法例 | BDD表現例 |
|--------|------|-----------|------|--------|----------|
| [日本語名] | [English] | [参照先] | [定義] | [使用例] | [Given/When/Then] |
```

**記入基準**:

- **英語名**: UpperCamelCaseでTypeScript実装可能
- **定義**: 曖昧さのない厳密な説明
- **BDD表現例**: Gherkin形式で実際に使用可能

### 5. 理解進捗・サイクル管理

**目的**: 理解深化プロセスの可視化と履歴管理

**フォーマット**:

```markdown
## Iteration N: [日時 or テーマ]

### 分析対象
- [ドキュメント/仕様名]

### 発見概念
- [新規抽出された概念リスト]

### 解決した質問
- [前回からの継続質問で解決されたもの]

### 新規/残存疑問
- [新たに発生した質問]
- [解決されなかった継続質問]

### 概念理解度更新
| 概念 | 前回 | 今回 | 変化理由 |
|------|------|------|----------|
| [概念名] | [%] | [%] | [理由] |

### 進捗コメント
- [サイクル全体の振り返り]
- [次回の重点項目]
```

### 6. 質問事項マトリックス

**目的**: ステークホルダーへの確認事項の体系管理

**フォーマット**:

```markdown
| カテゴリ | 対象 | 質問 | 緊急度 | 選択肢 | 背景・理由 |
|----------|------|------|--------|--------|-----------|
| [分類] | [確認先] | [具体質問] | [高/中/低] | [選択肢] | [なぜ必要か] |
```

**質問設計ルール**:

- **具体性**: Yes/No または選択肢で回答可能
- **背景明記**: なぜその質問が必要かを説明
- **緊急度**: 設計への影響度で優先順位付け

## 実施手順

### Phase 1: 初期分析（Iteration 1）

1. **情報源整理**: 全ドキュメントをリストアップし、読了計画を策定
2. **概念抽出**: 仕様書から名詞・動詞・状態を体系的に抽出
3. **初期分類**: Entity・ValueObject・Action候補の仮分類
4. **質問生成**: 理解不足・曖昧な箇所の質問事項作成

### Phase 2: 深掘りサイクル（Iteration 2-N）

1. **前回質問の回答反映**: ドメインエキスパートからの回答を整理
2. **理解度更新**: 概念理解マトリックスの理解度を再評価
3. **新規発見の追加**: 追加調査で発見された概念・ルールを追記
4. **質問の精緻化**: より具体的・実装寄りの質問を生成

### Phase 3: 確定・成果物化

1. **理解度評価**: 主要概念が80%以上の理解度に到達
2. **ユビキタス言語確定**: 用語統一マトリックスを正式版に昇格
3. **未解決事項の整理**: 残存質問を優先度別に整理
4. **次工程への引き継ぎ**: ドメインオブジェクト抽出への準備

## 品質チェックリスト

### 必須要件

- [ ] **完全性**: 仕様書の重要概念をすべて抽出済み
- [ ] **一貫性**: 用語定義に矛盾や重複がない
- [ ] **厳密性**: 曖昧な表現を排除し、具体的に定義
- [ ] **トレーサビリティ**: 各情報にエビデンスが明記
- [ ] **実装可能性**: TypeScript実装で直接利用可能な英語名

### 品質要件

- [ ] **理解度**: 主要概念の理解度が80%以上
- [ ] **質問の具体性**: 回答可能な形で質問が整理
- [ ] **進捗の可視性**: サイクルごとの変化が明確
- [ ] **チーム共有性**: 他メンバーが理解・継続可能

## 成功のポイント

### 効果的な質問設計

1. **具体的な選択肢**: 「どうしますか？」ではなく「A案とB案どちらですか？」
2. **実装影響の明示**: 「この決定はAPI設計にこう影響します」
3. **優先度の明確化**: 「この質問が解決しないと次に進めません」

### サイクル管理のコツ

1. **適切な粒度**: 1サイクル = 1-2日程度で完結する範囲
2. **進捗の可視化**: 理解度の数値変化で客観的評価
3. **継続性**: 担当者が変わっても引き継ぎ可能な記録

### ステークホルダー連携

1. **質問の事前準備**: 会議前に質問マトリックスを共有
2. **回答の即座反映**: 得られた回答を速やかにドキュメント更新
3. **進捗の共有**: 理解度向上を定期的に報告

## 完了判定基準

### 必須成果物

1. **概念理解マトリックス**: 主要概念の理解度80%以上
2. **確定ユビキタス言語**: BDD実装で使用可能な用語集
3. **ビジネスルール一覧**: 実装制約が明確化された仕様
4. **未解決事項リスト**: 優先度付きの残存課題

### 次工程移行条件

- 主要ドメイン概念の抽出・定義完了
- Entity/ValueObject候補の仮分類完了
- 重要ビジネスルールの制約明確化
- ドメインエキスパートとの合意形成

## 運用上の注意

### よくある失敗パターン

1. **一度で完璧を目指す**: サイクル方式の利点を活かさない
2. **曖昧な質問**: 回答できない抽象的な質問を作成
3. **エビデンス不足**: 情報源が不明で検証できない
4. **理解度の主観評価**: 客観的基準のない%評価

### 成功のための心構え

1. **段階的理解**: 完璧より継続的改善を重視
2. **質問の質**: 量より質の高い具体的質問
3. **記録の徹底**: 暗黙知を形式知化する意識
4. **チーム資産**: 個人の理解をチーム全体の財産に

## 参考資料

- プロジェクト仕様書・要件定義
- DDD戦略的設計（境界づけられたコンテキスト）
- ドメインエキスパートインタビュー技法
- 要求工学・要件抽出手法
