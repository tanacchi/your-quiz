# ADR-0002: アプリケーションアーキテクチャパターン選定

## Status

Accepted

## Context

### Background

- モジュラーモノリス内でのアプリケーション層のアーキテクチャパターンを決定する必要がある
- ドメインロジック（クイズ・回答・履歴）の独立性確保が重要
- TDD/BDD対応とテスタビリティを重視する開発方針

### Drivers

- **ドメイン中心設計**: クイズドメインロジックの独立性確保
- **テスタビリティ**: TDD/BDD対応、外部依存の分離
- **技術制約適合**: TypeScriptでの実装容易性
- **将来拡張性**: 外部システム連携（認証・通知等）への対応
- **オフライン対応**: 複数アダプター（DB、IndexedDB）実装の必要性

## Decision

### Chosen Option

### ヘキサゴナルアーキテクチャ（ポート&アダプターパターン）

ドメインロジックの完全分離と高いテスタビリティを重視し、ヘキサゴナルアーキテクチャを採用する。

### Alternatives Considered

| 選択肢 | メリット | デメリット | 適用場面 | TypeScript適合性 | 学習曲線 | 評価 |
|--------|----------|------------|----------|------------------|----------|------|
| **ヘキサゴナル** | **・ドメイン完全分離**<br>**・高いテスタビリティ**<br>**・外部依存注入容易**<br>**・ポート/アダプター明確** | **・初期設計コスト**<br>**・レイヤー間のマッピング**<br>**・概念理解必要** | **・ドメイン複雑**<br>**・TDD重視**<br>**・外部連携多** | **高** | **中** | **★★★** |
| レイヤードアーキテクチャ | ・理解容易<br>・実装単純<br>・従来手法<br>・学習コスト低 | ・ドメイン散在リスク<br>・テスト困難<br>・技術依存強<br>・外部依存分離困難 | ・シンプルCRUD<br>・小規模システム<br>・短期開発 | 中 | 低 | ★★ |
| クリーンアーキテクチャ | ・依存関係逆転<br>・ドメイン中心<br>・高い抽象度<br>・エンタープライズ対応 | ・過度な抽象化<br>・学習コスト高<br>・実装複雑<br>・オーバーエンジニアリング | ・大規模システム<br>・長期運用<br>・複数チーム | 中 | 高 | ★ |

## Consequences

### Positive

- ドメインロジック（クイズ・回答・履歴）の完全な独立性確保
- 高いテスタビリティ（モック・スタブ活用が容易）
- 外部依存注入の容易性（DB、IndexedDB、外部API）
- 将来の外部システム連携（認証・通知）への拡張性
- TypeScriptの型安全性とインターフェース設計の親和性

### Negative

- 初期設計コストの増加（ポート・アダプター設計）
- レイヤー間のマッピング処理が必要
- チームメンバーへの概念説明・学習コスト
- 小規模機能に対する潜在的なオーバーエンジニアリング

### Neutral

- 明確なレイヤー分離による責務の明確化
- インターフェース駆動開発の徹底

### Risks and Mitigation

| リスク | 発生確率 | 影響度 | 対策 |
|--------|----------|--------|------|
| 過度な抽象化による開発効率低下 | 中 | 中 | 適切な抽象化レベルの設定、実用的な設計判断 |
| レイヤー間マッピングの複雑化 | 低 | 中 | AutoMapper等のライブラリ活用、単純なマッピング設計 |
| チームの学習曲線による初期遅延 | 高 | 低 | 段階的導入、ペアプログラミング、設計レビュー |

## Implementation Notes

### Action Items

- [ ] ポート（インターフェース）設計の策定
- [ ] アダプター（実装）設計パターンの確立
- [ ] ドメイン層・アプリケーション層の境界定義
- [ ] DIコンテナ設計（TypeScript）
- [ ] テストダブル（モック・スタブ）戦略の策定

### モジュール構成

```text
src/
├── modules/
│   ├── quiz-management/     # クイズ管理コンテキスト
│   │   ├── domain/          # エンティティ・VO・ドメインサービス
│   │   ├── application/     # ユースケース・アプリケーションサービス
│   │   ├── infrastructure/  # リポジトリ実装・外部API
│   │   └── presentation/    # コントローラー・DTO
│   ├── answer-history/      # 回答履歴コンテキスト
│   └── shared/              # 共通コンテキスト
```

### Timeline

- **決定日**: 2025-01-27
- **実装開始**: 詳細設計フェーズ
- **完了予定**: 基本実装完了時

## References

- [ヘキサゴナルアーキテクチャ図](../diagrams/hexagonal-architecture.md)
- [モジュラーモノリス構造図](../diagrams/modular-monolith-structure.md)
- [ADR-0001: システムアーキテクチャパターン選定](0001-architecture-pattern.md)

---
**Created**: 2025-07-27
**Last Updated**: 2025-07-27
**Authors**: Claude
**Reviewers**: [@tanacchi](https://github.com/tanacchi)
