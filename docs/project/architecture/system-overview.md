# システム全体俯瞰

## システムアーキテクチャパターン選定

### 選定結果
**採用**: モジュラーモノリス

### 判断基準
- **チーム規模**: 1-2名での開発、小規模チーム
- **ビジネス要件**: シンプルなクイズ機能、将来的な機能拡張の可能性、匿名ユーザー中心
- **非機能要件**: 最大100同時接続、API応答時間100ms、オフライン対応必要
- **技術制約**: TypeScript統一、フロントエンド（Next.js/React Router v7）、API（Hono/Nest）
- **組織制約**: 迅速な開発、シンプルな運用、将来的な拡張性確保

### 比較検討

| 選択肢 | メリット | デメリット | 適用可能性 | チーム適合性 | 運用負荷 | 評価 |
|--------|----------|------------|------------|------------|----------|------|
| **モジュラーモノリス** | **・単一デプロイで運用単純**<br>**・モジュール境界による責務分離**<br>**・将来的なマイクロサービス分割可能**<br>**・トランザクション整合性確保** | **・モジュール境界の規律維持必要**<br>**・単一障害点のリスク** | **・中規模システム**<br>**・成長期プロダクト**<br>**・境界明確なドメイン** | **高（TypeScript統一）** | **低** | **★★★** |
| モノリス | ・開発初期の高速性<br>・デプロイ・デバッグ容易<br>・トランザクション単純 | ・将来の拡張性制限<br>・技術スタック固定<br>・責務境界曖昧化リスク | ・小規模システム<br>・MVP段階<br>・単純ドメイン | 高 | 低 | ★★ |
| マイクロサービス | ・独立デプロイ<br>・技術選択自由<br>・障害分離<br>・水平スケール | ・分散システム複雑性<br>・運用コスト高<br>・ネットワーク遅延<br>・データ整合性課題 | ・大規模システム<br>・複数チーム<br>・高可用性要求 | 低（小規模チーム） | 高 | ★ |

### 選定理由
1. **主要理由**: 小規模チームでの開発効率と将来の拡張性のバランス
2. **副次理由**: TypeScript統一による開発体験向上、単一デプロイによる運用負荷軽減
3. **将来性**: ドメイン境界が明確になった段階でのマイクロサービス分割可能

### トレードオフ
**得られるもの**:
- 開発初期の生産性向上
- 運用負荷の軽減
- 責務分離による保守性
- 将来的な分割オプション

**失うもの/リスク**:
- 完全な独立デプロイは不可
- 単一障害点のリスク（適切な冗長化で対応）
- モジュール境界の規律維持コスト

### 後続工程への影響
- **DDD設計**: 境界付きコンテキスト設計が重要、モジュール境界=コンテキスト境界
- **API設計**: 内部モジュール間通信は関数呼び出し、外部APIはREST
- **DB設計**: 単一データベース、スキーマ/テーブル単位でのモジュール分離
- **技術選定**: 統一技術スタック（TypeScript）、モジュール境界明確化ツール選定

## アプリケーションアーキテクチャパターン選定

### 選定結果
**採用**: ヘキサゴナルアーキテクチャ（ポート&アダプターパターン）

### 判断基準
- **ドメイン中心設計**: クイズドメインロジックの独立性確保
- **テスタビリティ**: TDD/BDD対応、外部依存の分離
- **技術制約適合**: TypeScriptでの実装容易性
- **将来拡張性**: 外部システム連携（認証・通知等）への対応

### 比較検討

| 選択肢 | メリット | デメリット | 適用場面 | TypeScript適合性 | 学習曲線 | 評価 |
|--------|----------|------------|----------|------------------|----------|------|
| **ヘキサゴナル** | **・ドメイン完全分離**<br>**・高いテスタビリティ**<br>**・外部依存注入容易** | **・初期設計コスト**<br>**・レイヤー間のマッピング** | **・ドメイン複雑**<br>**・TDD重視**<br>**・外部連携多** | **高** | **中** | **★★★** |
| レイヤード | ・理解容易<br>・実装単純<br>・従来手法 | ・ドメイン散在リスク<br>・テスト困難<br>・技術依存強 | ・シンプルCRUD<br>・小規模システム | 中 | 低 | ★★ |
| クリーン | ・依存関係逆転<br>・ドメイン中心<br>・高い抽象度 | ・過度な抽象化<br>・学習コスト高<br>・実装複雑 | ・大規模システム<br>・長期運用 | 中 | 高 | ★ |

### 選定理由
1. **主要理由**: ドメインロジック（クイズ・回答・履歴）の独立性確保
2. **副次理由**: オフライン対応等の複数アダプター実装に適合
3. **将来性**: 外部認証・通知システム連携時の拡張容易性

## システム境界・コンテキスト設計

### モジュール構成

```
src/
├── modules/
│   ├── quiz-management/     # クイズ管理コンテキスト
│   │   ├── domain/          # エンティティ・VO・ドメインサービス
│   │   ├── application/     # ユースケース・アプリケーションサービス
│   │   ├── infrastructure/  # リポジトリ実装・外部API
│   │   └── presentation/    # コントローラー・DTO
│   ├── answer-history/      # 回答履歴コンテキスト
│   │   ├── domain/
│   │   ├── application/
│   │   ├── infrastructure/
│   │   └── presentation/
│   └── shared/              # 共通コンテキスト
│       ├── domain/          # 共通VO・仕様
│       ├── infrastructure/  # DB接続・ログ・認証
│       └── presentation/    # 共通ミドルウェア
└── app/                     # アプリケーションエントリーポイント
```

### 外部システム連携方針

| 連携先 | 連携方式 | 理由 | データ形式 | エラーハンドリング |
|--------|----------|------|------------|-------------------|
| ブラウザストレージ | Direct Access | オフライン対応・履歴保存 | JSON | バックアップ+同期 |
| 将来の認証システム | REST API | リアルタイム認証要求 | JSON | リトライ+フォールバック |
| 将来の通知システム | Message Queue | 非同期・高可用性 | JSON | Dead Letter Queue |

### システム境界定義
- **内部システム**: クイズ管理・回答履歴・共通サービス
- **外部システム**: ブラウザストレージ、将来の認証・通知システム
- **境界インターフェース**: ドメインサービス・リポジトリインターフェース