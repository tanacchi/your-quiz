
# 技術選定

## フロントエンド技術選定

### フレームワーク選定

**選定結果**: Next.js 15 (App Router)

**選定理由**: PWA対応によるオフライン機能実装が容易で、スマートフォン最適化・TypeScript開発体験・将来のSEO対応への拡張性が最適。

**詳細な比較検討**: [ADR-0003: フロントエンドフレームワーク選定](adr/0003-frontend-framework.md)

### UI・スタイリング

**選定結果**: Tailwind CSS

**選定理由**: Tinder風UI（スワイプ）実装時のアニメーション・レスポンシブ対応が容易で、カスタムデザインとモバイル最適化に最適。

**詳細な比較検討**: [ADR-0004: UI・スタイリング技術選定](adr/0004-ui-styling.md)

### 状態管理

**選定結果**: Zustand

**選定理由**: クイズ状態・履歴管理の要件がシンプルで、TypeScriptとの親和性・軽量性（~3KB）・設定容易さが最適。2025年トレンドで中小規模アプリの標準的選択。

**詳細な比較検討**: [ADR-0005: 状態管理ライブラリ選定](adr/0005-state-management.md)

## バックエンド技術選定

### APIフレームワーク

**選定結果**: Hono

**選定理由**: API応答時間100ms要件への最適化、TypeScriptファーストの開発体験、シンプルなAPI要件（CRUD中心）に適合。

**詳細な比較検討**: [ADR-0006: バックエンドフレームワーク選定](adr/0006-backend-framework.md)

### データベース選定

**選定結果**: PostgreSQL (Neon等) + Cloudflare Hyperdrive

**選定理由**: データベースリプレースの困難さとPostgreSQL互換性の重要性を重視。D1はSQLiteベースでPostgreSQL直接互換なし。Cloudflare HyperdriveでPostgreSQLの高速アクセスが可能。

**詳細な比較検討**: [ADR-0007: データベース選定](adr/0007-database.md)

### ORM選定

**選定結果**: Drizzle ORM

**選定理由**: TypeScript特化・軽量・SQL透明性・型安全性が現状の要件に最適。PostgreSQL対応も良好で、パフォーマンス要件を満たす。

**詳細な比較検討**: 関連ADR参照

## インフラ・運用技術選定

### フロントエンドホスティング

| プラットフォーム | メリット | デメリット | 適用場面 | 無料枠 | パフォーマンス | 判定 |
|------------------|----------|------------|----------|--------|---------------|------|
| **Vercel** | **Next.js最適化、自動デプロイ、エッジ配信、PWA対応** | **ベンダーロック、API制限、コスト上昇** | **Next.js、フロントエンド中心、高速配信** | **100GB/月** | **★★★** | **○** |
| Netlify | Git統合、フォーム対応、Functions、CDN | 遅延問題、ビルド制限、複雑設定時問題 | 静的サイト、JAMstack、シンプル構成 | 100GB/月 | ★★ | △ |
| Cloudflare Pages | 高速配信、無制限帯域、低レイテンシ、エッジ最適化 | 機能限定、新しいサービス、学習コスト | エッジ重視、グローバル配信、高速化 | 無制限 | ★★★ | ○ |

**選定結果**: Vercel

**選定理由**: Next.js最適化、PWA対応、100ms要件への最適化

### APIホスティング（バックエンド）

| プラットフォーム | メリット | デメリット | 適用場面 | 無料枠 | パフォーマンス | 技術適合性 | 判定 |
|------------------|----------|------------|----------|--------|---------------|------------|------|
| Cloudflare Workers | 超高速、エッジ実行、無制限リクエスト、低コスト | 実行時間制限、Node.js制限、デバッグ困難 | エッジAPI、高トラフィック、シンプル処理 | 100,000req/日 | ★★★ | Hono最適化 | ○ |
| Railway | シンプル設定、DB統合、Git連携、スケーリング自動 | 新しいサービス、実績少、料金体系変更リスク | フルスタック、小中規模、MVP開発 | $5クレジット/月 | ★★★ | Hono対応 | ○ |
| Render | Docker対応、DB統合、自動デプロイ、実績豊富 | 無料枠制限厳しい、スリープ問題、設定複雑 | Docker化、安定運用、エンタープライズ | 750時間/月 | ★★ | Hono対応 | △ |
| Fly.io | エッジ配信、低レイテンシ、Docker最適、グローバル展開 | 設定複雑、学習コスト高、課金体系複雑 | エッジコンピューティング、レイテンシ重視 | $5クレジット/月 | ★★★ | Hono最適 | ○ |
| Supabase Functions | PostgreSQL統合、Edge Functions、Auth統合、TypeScript | Serverless制限、実行時間制限、デバッグ困難 | DB重視、Auth必要、Serverless | 500MB DB無料 | ★★ | TypeScript対応 | △ |
| PlanetScale + Vercel Functions | MySQL互換、ブランチング、自動スケール、エッジ | コスト高、ベンダーロック、複雑構成 | 大規模DB、ブランチ運用 | 10GB DB無料 | ★★ | 要適合作業 | △ |

#### 詳細比較：Railway vs Fly.io vs Cloudflare Workers

| 項目 | Railway | Fly.io | Cloudflare Workers |
|------|---------|--------|-------------------|
| **起動時間** | ~500ms | ~200ms | ~1ms |
| **コールドスタート** | あり | あり | なし |
| **100ms要件対応** | △（ウォームアップ必要） | ○（エッジ配置） | ○（エッジネイティブ） |
| **データベース** | 統合PostgreSQL | 外部接続 | 外部接続（D1/KV） |
| **無料枠** | $5/月クレジット | $5/月クレジット | 100,000req/日 |
| **運用負荷** | 低 | 中 | 低 |
| **学習コスト** | 低 | 中 | 中 |

**選定結果**: Cloudflare Workers + D1 Database
**選定理由**:
1. HonoはCloudflare Workers向けに設計されており最高の親和性
2. 100ms要件対応: エッジ実行でコールドスタートなし（~1ms起動）
3. 十分な無料枠: 100,000リクエスト/日 + 25GB DB - クイズアプリには十分
4. クイズアプリの特性: 複雑なクエリ不要、CRUD中心の単純な処理
5. 運用シンプル: 単一プラットフォームで完結、管理負荷最小
6. D1はSQLite互換で、将来的なPostgres移行も視野に入る（Neon等）。DBはアプリケーションと違いリプレースが困難なため、初期選定時にPostgres互換性・移行性を重視すること。

#### 2.4 エラーハンドリングライブラリ

**選定必須理由**: TypeScript環境での関数型エラーハンドリング統一のため

| ライブラリ | メリット | デメリット | 適用場面 | 学習コスト | メンテナンス性 | パフォーマンス | 判定 |
|------------|----------|------------|----------|------------|---------------|--------------|------|
| **neverthrow** | ・Result型提供<br>・型安全なエラー処理<br>・関数型プログラミング対応<br>・TypeScript最適化 | ・学習曲線急<br>・既存コード移行コスト<br>・チーム教育必要 | ・API結果処理<br>・ビジネスロジック<br>・外部連携 | 中 | 高 | 高 | ○ |
| fp-ts | ・高機能<br>・関数型エコシステム充実<br>・数学的厳密性 | ・学習コスト極高<br>・オーバーエンジニアリング<br>・可読性低下リスク | ・関数型プログラミング中心<br>・複雑なデータ変換 | 高 | 高 | 中 | × |
| 独自実装 | ・プロジェクト特化<br>・軽量<br>・完全制御 | ・テスト負荷<br>・保守コスト<br>・バグリスク | ・シンプルな要件<br>・特殊制約 | 低 | 低 | 高 | △ |

**選定結果**: neverthrow
**選定理由**:

- TypeScript環境に最適化されており型安全性が高い
- 学習コストは中程度でチーム導入可能
- Result型による統一的なエラーハンドリングが実現可能

#### 2.5 テストフレームワーク

**選定必須理由**: TypeScript対応・高速実行・Vite統合のため

| フレームワーク | メリット | デメリット | 適用場面 | 実行速度 | TypeScript対応 | 設定容易さ | 判定 |
|---------------|----------|------------|----------|----------|---------------|------------|------|
| **Vitest** | ・Vite統合<br>・高速実行<br>・TypeScript最適<br>・Jest互換API | ・新しい技術<br>・エコシステム発展途上<br>・学習リソース限定 | ・Viteプロジェクト<br>・モダンテスト<br>・高速開発 | 高 | 高 | 高 | ○ |
| Jest | ・成熟エコシステム<br>・豊富な機能<br>・学習リソース多<br>・企業採用実績 | ・設定複雑<br>・実行速度<br>・ESM対応課題 | ・従来型開発<br>・安定性重視<br>・大規模テスト | 中 | 中 | 中 | △ |

**選定結果**: Vitest
**選定理由**:

- Viteとの統合により高速なテスト実行が可能
- TypeScript対応が優秀で型安全なテストが実現できる
- Jest互換APIで既存知識を活用可能

#### 2.6 型定義・コード生成ツール

**選定必須理由**: OpenAPI仕様からTypeScript型を自動生成し、型安全なAPI開発を実現するため

| ツール | メリット | デメリット | 適用場面 | 型安全性 | 保守性 | 学習コスト | 判定 |
|--------|----------|------------|----------|----------|--------|------------|------|
| **openapi-typescript** | ・OpenAPI→TypeScript<br>・自動生成<br>・型安全なAPI呼び出し<br>・フロントエンド統合 | ・生成ファイル大<br>・カスタマイズ制限<br>・OpenAPI依存 | ・API型定義<br>・フロント/バック統合<br>・TypeSpec連携 | 高 | 中 | 低 | ○ |
| 手動定義 | ・柔軟性<br>・カスタマイズ自由 | ・保守負荷<br>・型漏れリスク<br>・自動化不可 | ・小規模API<br>・特殊要件 | 中 | 低 | 高 | × |

**選定結果**: openapi-typescript
**選定理由**:

- OpenAPI仕様から自動で型定義を生成できるため、型安全性と保守性が高い
- フロントエンド・バックエンド間の型不整合リスクを低減できる

1. **Hono最適化**: HonoはCloudflare Workers向けに設計されており最高の親和性
2. **100ms要件対応**: エッジ実行でコールドスタートなし（~1ms起動）
3. **十分な無料枠**: 100,000リクエスト/日 + 25GB DB - クイズアプリには十分
4. **クイズアプリの特性**: 複雑なクエリ不要、CRUD中心の単純な処理
5. **運用シンプル**: 単一プラットフォームで完結、管理負荷最小

**D1制約の対応**:

- SQLite互換のため、既存のDrizzle ORMとSQLite開発経験が活用可能
- クイズデータのシンプルな構造には十分
- 分析等が必要になった場合のみ、後からNeon等への移行を検討

### データベースホスティング

| サービス | メリット | デメリット | 無料枠 | パフォーマンス | 適用時期 |
|----------|----------|------------|--------|---------------|----------|
| **D1 Database (Cloudflare)** | **エッジ配置、超高速、SQLite互換、無料枠大** | **機能制限、新しいサービス、分析クエリ弱** | **25GB** | **★★★** | **MVP期** |
| Neon PostgreSQL | Serverless、ブランチング、自動スケール | 新しい、制限あり、レイテンシ | 3GB | ★★ | 成長期 |
| PlanetScale MySQL | ブランチング、自動スケール、企業実績 | 高コスト、MySQL制約 | 10GB | ★★ | スケール期 |
| Railway PostgreSQL | 統合管理、シンプル設定、自動バックアップ | 単一AZ、制限あり | $5クレジット分 | ★★ | 安定期 |

**選定結果**: **D1 Database**（Cloudflare Workers統合）

**選定理由**: SQLite互換でシンプル、25GB無料枠、エッジ配置による高速アクセス

### 開発ツール（Linting・フォーマット）

**選定結果**: Biome

**選定理由**: TypeScript開発体験の最適化、設定の単純化、Rust製で高速処理がLint+Format統合で実現。

**詳細な比較検討**: 関連ADR参照

### CI/CD・デプロイメント

**選定結果**: GitHub Actions

**選定理由**: GitHub中心の開発フローとの統合、Vercel・Cloudflare Workers自動デプロイとの親和性、小規模チームでの運用負荷軽減。

**詳細な比較検討**: 関連ADR参照

### E2Eテストフレームワーク

**選定結果**: Playwright

**選定理由**: Next.jsやPWA環境との高い互換性、TypeScriptによる型安全なテスト記述、CI/CD（GitHub Actions）との統合が容易。

**詳細な比較検討**: 関連ADR参照

## まとめ

### 採用技術スタック

**フロントエンド**:

- Framework: Next.js 15 (App Router)
- Styling: Tailwind CSS
- State: Zustand
- Language: TypeScript

**バックエンド**:

- Framework: Hono
- Database: SQLite → PostgreSQL
- ORM: Drizzle ORM
- Language: TypeScript

**インフラ・運用**:

- Frontend Hosting: Vercel
- Backend Hosting: Cloudflare Workers
- Database: D1 Database
- CI/CD: GitHub Actions
- Linting: Biome

### アーキテクチャ整合性確認

- ✅ モジュラーモノリス: 単一リポジトリ、境界明確なモジュール構成
- ✅ ヘキサゴナルアーキテクチャ: Drizzle ORMによるリポジトリパターン実装
- ✅ TypeScript統一: フロントエンド・バックエンド全体での型安全性
- ✅ パフォーマンス要件: Hono + Cloudflare Workers エッジ実行による100ms要件対応
- ✅ PWA対応: Next.js + Vercelによるオフライン機能実装
- ✅ 費用効率: Cloudflare Workers（100,000req/日無料）+ D1 Database（25GB無料）
- ✅ 運用シンプル: 単一プラットフォーム（Cloudflare）で完結
