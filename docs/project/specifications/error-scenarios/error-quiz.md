# 失敗パターン: クイズ機能

## エラーシナリオ: サーバー通信エラー

**発生条件**:

- クイズ回答送信時にサーバーエラーが発生
- ネットワーク接続不良またはサーバー障害

**実行手順**:

1. ユーザーがクイズに回答してスワイプ
2. サーバーへの通信リクエストが失敗
3. システムがエラーを検知

**期待結果**:

- エラーメッセージとエラーコードを表示
- 「通信に失敗しました。オフラインモードで遊びますか？」の選択肢を提示
- ユーザーの回答は一時的にブラウザに保存

## エラーシナリオ: バリデーションエラー

**発生条件**:

- クイズ作成時に必須項目（問題文・正解）が未入力
- 文字数制限を超過（問題文500文字、解説1000文字）
- 不正な文字列が入力された場合

**実行手順**:

1. ユーザーがクイズ作成フォームに不正な値を入力
2. 投稿ボタンをクリック
3. バリデーションチェックが実行される

**期待結果**:

- 具体的なエラーメッセージとエラーコードを表示
- 入力フィールドにフォーカスして修正を促す
- XSS対策としてHTMLタグはサニタイズされる

## エラーシナリオ: 未承認クイズアクセス

**発生条件**:

- 他ユーザーが未承認状態のクイズに直接アクセス試行
- 承認待ちクイズのIDを推測してアクセス

**実行手順**:

1. 未承認クイズのURLに直接アクセス
2. システムが承認状態をチェック
3. アクセス権限がないことを判定

**期待結果**:

- アクセス拒否メッセージとエラーコードを表示
- 作成者以外は未承認クイズを閲覧できない
- 適切な権限チェックが実行される

## エラーシナリオ: ブラウザストレージ制限

**発生条件**:

- indexedDBの容量制限に達した状態
- 大量の回答履歴やオフラインデータが蓄積

**実行手順**:

1. 新しい回答履歴の保存を試行
2. ブラウザストレージの容量制限に達する
3. 保存処理が失敗

**期待結果**:

- ストレージ容量不足のエラーメッセージを表示
- 古い履歴データの削除を提案
- 機能の継続利用のための対処法を案内
