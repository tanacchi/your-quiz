# ドメインオブジェクト抽出・分析フォーマット比較・推奨案

## 概要

ドメインオブジェクトの抽出・分析における5つのアプローチを比較し、プロジェクト特性・チーム状況・開発目標に応じた推奨案を提示します。各アプローチの特徴・適用場面・実装への影響を分析します。

---

## 📊 5案の比較表

| 項目 | 案1: 振る舞い・責任マトリックス | 案2: ユースケース駆動抽出 | 案3: 概念マップ型 | 案4: イベント駆動分析 | 案5: ビジネスルール中心 |
|------|----------------------------|---------------------|------------------|-------------------|---------------------|
| **ビジネス価値対応** | ✅ 高 | ✅ 最高 | 🔶 中 | 🔶 中 | ✅ 高 |
| **実装指針明確さ** | ✅ 高 | ✅ 高 | 🔶 中 | 🔶 中 | ✅ 高 |
| **関係性可視化** | 🔶 中 | 🔶 中 | ✅ 最高 | 🔶 中 | ❌ 低 |
| **保守性・拡張性** | 🔶 中 | 🔶 中 | ✅ 高 | ✅ 高 | ✅ 高 |
| **学習コスト** | 🔶 中 | ✅ 低 | 🔶 中 | ❌ 高 | 🔶 中 |
| **分析工数** | 🔶 中 | ✅ 低 | ❌ 高 | ❌ 高 | ❌ 高 |
| **チーム共有性** | ✅ 高 | ✅ 高 | ✅ 高 | 🔶 中 | 🔶 中 |
| **技術適合性** | 🔶 中 | 🔶 中 | 🔶 中 | ✅ 高 | 🔶 中 |

### 詳細評価

#### 🎯 ビジネス価値対応
- **最優秀**: 案2（ユースケース駆動）- ビジネス価値による優先度設定
- **優秀**: 案1（振る舞い・責任）, 案5（ビジネスルール）- ビジネス重視の設計
- **普通**: 案3（概念マップ）, 案4（イベント駆動）- 技術的な観点が強い

#### 💻 実装指針明確さ
- **優秀**: 案1,2,5 - 具体的な実装方針・集約設計を提供
- **普通**: 案3,4 - 概念的な理解は深いが実装指針は抽象的

#### 🔗 関係性可視化
- **最優秀**: 案3（概念マップ）- Mermaid図による直感的な関係性表現
- **普通**: その他 - テキストベースの関係性説明

#### 🔧 保守性・拡張性
- **優秀**: 案3,4,5 - 変更容易性・新機能追加への対応
- **普通**: 案1,2 - 基本的な保守性は確保

#### 📚 学習コスト・分析工数
- **低コスト**: 案2（ユースケース駆動）- 既存仕様から自然に導出
- **高コスト**: 案3,4,5 - 専門知識・詳細分析が必要

---

## 🎯 推奨案の選定

### 🥇 最優先推奨: 案2「ユースケース駆動抽出型」

#### 推奨理由
1. **ビジネス価値直結**: ユースケースの価値による優先度で開発順序決定
2. **実用性**: 実際のユースケース実現に必要なドメインオブジェクト抽出
3. **理解容易**: 既存の仕様書から自然に導出可能
4. **実装指針**: 具体的な集約設計・サービス抽出指針を提供
5. **段階開発**: ユースケース優先度による段階的実装計画

#### 適用場面
- **ほぼ全ての場合**（特にビジネス価値重視の開発）
- ユースケース仕様が充実している場合
- 段階的リリース・優先度付け開発の場合
- チームがユースケース分析に慣れている場合

### 🥈 第2推奨: 案1「振る舞い・責任マトリックス型」

#### 推奨理由
1. **責任明確化**: 各ドメインの振る舞い・責任が明確に定義
2. **バランス**: ビジネス・技術両面のバランスが良い
3. **実装支援**: マトリックス形式で実装時の参照が容易
4. **関係性理解**: ドメイン間の協調パターンが明確
5. **サービス抽出**: 自然なドメインサービス候補の特定

#### 適用場面
- ドメインロジックが複雑で責任分散が重要
- チーム内でのドメイン理解統一が必要
- 実装チームとの密な連携が重要
- ドメインサービス設計を重視する場合

### 🥉 第3推奨: 案5「ビジネスルール中心分析型」

#### 推奨理由
1. **品質重視**: ビジネスルール違反の早期検出・防止
2. **監査対応**: ルール実行履歴の完全な追跡可能性
3. **保守性**: ルール変更時の影響範囲が明確
4. **集約設計**: 不変条件に基づく自然な集約境界設定
5. **テスト設計**: ルール単位での体系的なテスト設計

#### 適用場面
- ビジネスルールが複雑・頻繁に変更される場合
- コンプライアンス・監査要件が厳しい場合
- データ品質・整合性が最重要な場合
- 規制が厳しい業界（金融・医療・法律等）

---

## 📋 状況別推奨マトリックス

| プロジェクト特性 | 第1推奨 | 第2推奨 | 理由 |
|------------------|---------|---------|------|
| **標準的な業務アプリ** | 案2（ユースケース駆動） | 案1（振る舞い・責任） | ビジネス価値・実用性 |
| **複雑なドメインロジック** | 案1（振る舞い・責任） | 案5（ビジネスルール） | 責任分散・ルール管理 |
| **段階的リリース重視** | 案2（ユースケース駆動） | 案1（振る舞い・責任） | 優先度設定・実装順序 |
| **高い保守性要求** | 案5（ビジネスルール） | 案3（概念マップ） | ルール変更対応・関係性管理 |
| **イベント駆動アーキテクチャ** | 案4（イベント駆動） | 案2（ユースケース駆動） | アーキテクチャ適合・イベント設計 |
| **マイクロサービス** | 案4（イベント駆動） | 案3（概念マップ） | 分散システム・境界設定 |
| **小規模チーム** | 案2（ユースケース駆動） | 案1（振る舞い・責任） | 学習コスト・実用性 |
| **大規模チーム** | 案3（概念マップ） | 案1（振る舞い・責任） | 関係性可視化・責任分散 |
| **新規プロダクト** | 案2（ユースケース駆動） | 案1（振る舞い・責任） | ビジネス価値・実装指針 |
| **レガシー再構築** | 案5（ビジネスルール） | 案4（イベント駆動） | ルール保全・現代化 |

---

## 🚀 実装ガイドライン

### Step 1: 推奨案の選択
1. 上記「状況別推奨マトリックス」で自分のプロジェクト特性を特定
2. 第1推奨案を基本とし、必要に応じて第2推奨案の要素を組み込み
3. チーム内で選択した案を合意・承認

### Step 2: フォーマットの準備
1. 選択した案のテンプレートを `docs/project/ddd-design/domain-object-classification.md` にコピー
2. プロジェクト固有情報（specifications等）を確認
3. 必要に応じてセクション・項目をカスタマイズ

### Step 3: 段階的実装
1. **Phase 1**: 核心ドメイン（5-10個）を先行抽出・分析
2. **Phase 2**: 集約設計・ドメインサービス設計
3. **Phase 3**: 実装・テスト実行
4. **Phase 4**: フィードバック反映・継続改善

### Step 4: 品質保証
1. ドメインオブジェクトの責任明確性確認
2. ビジネスルール・制約の実装状況確認
3. ユースケース実現可能性の検証
4. チーム内でのドメイン理解度確認

---

## 📈 期待効果とメトリクス

### 案2（ユースケース駆動）採用時の期待効果
- **開発効率**: ビジネス価値順の開発で早期価値提供
- **品質向上**: ユースケース実現に必要十分なドメイン設計
- **チーム理解**: ユースケースベースでの共通理解形成
- **保守性**: ユースケース変更時の影響範囲限定

### 案1（振る舞い・責任）採用時の期待効果
- **設計品質**: 責任分散による高品質なドメイン設計
- **実装指針**: 明確な責任に基づく実装方針提供
- **チーム協調**: 責任マトリックスでの役割分担最適化
- **拡張性**: 新機能追加時の責任配置明確化

### 案5（ビジネスルール中心）採用時の期待効果
- **品質保証**: ビジネスルール違反の早期検出で品質向上
- **監査対応**: 完全なルール実行履歴で監査要件対応
- **保守効率**: ルール変更時の影響範囲明確化で保守効率化
- **テスト品質**: ルール単位テストで体系的品質保証

---

## 🔄 ハイブリッド運用の提案

### 段階的アプローチ
多くのプロジェクトでは、**段階的なハイブリッド運用**が現実的です：

#### Phase 1: ユースケース駆動でスタート（案2）
- プロジェクト初期は案2でユースケース価値重視
- 核心ユースケースの実現に必要なドメインオブジェクト抽出
- ビジネス価値による優先度設定・段階実装計画

#### Phase 2: 振る舞い・責任分析を追加（案2 + 案1要素）
- ドメインロジック複雑化時に責任分散分析を追加
- 既存のユースケース分析に責任マトリックス情報を追加
- ドメインサービス抽出・集約境界の精緻化

#### Phase 3: 専門分析を選択的適用
- **概念関係重視**: 案3要素を追加（複雑な関係性可視化）
- **イベント駆動必要**: 案4要素を追加（非同期・分散処理）
- **ルール管理重要**: 案5要素を追加（コンプライアンス・監査）

#### Phase 4: 統合・最適化
- プロジェクト成熟時に全体最適化
- チーム状況・プロダクト特性に応じた最終調整
- 継続的改善による進化

### 組み合わせパターン例

#### パターン1: ビジネス重視型（案2 + 案1）
```
ユースケース駆動抽出 → 振る舞い・責任分析 → 実装設計
```
- 最も実用的で多くのプロジェクトに適用可能
- ビジネス価値と技術品質のバランス

#### パターン2: 高品質型（案2 + 案5）
```
ユースケース駆動抽出 → ビジネスルール中心分析 → 品質重視実装
```
- 品質・監査要件が厳しいプロジェクト向け
- ビジネス価値と品質保証の両立

#### パターン3: 大規模対応型（案2 + 案3 + 案4）
```
ユースケース駆動抽出 → 概念マップ化 → イベント駆動設計
```
- 大規模・分散システム向け
- 複雑性管理と拡張性の重視

---

## 📝 まとめ

### 一般的な推奨
- **デフォルト選択**: 案2「ユースケース駆動抽出型」
- **複雑ドメイン**: 案1「振る舞い・責任マトリックス型」
- **品質・監査重視**: 案5「ビジネスルール中心分析型」
- **大規模・分散**: 案4「イベント駆動分析型」
- **関係性重視**: 案3「概念マップ型」

### 成功のポイント
1. **プロジェクト特性に応じた適切な選択**
2. **チーム全体での合意とコミット**
3. **段階的導入による無理のない運用**
4. **継続的な見直しと改善**
5. **ビジネス価値と技術品質のバランス**

### 避けるべき失敗パターン
- ❌ **手法偏重**: 手法に固執してビジネス価値を見失う
- ❌ **完璧主義**: 最初から完璧を目指しすぎて進まない
- ❌ **分析過多**: 分析に時間をかけすぎて実装が遅れる
- ❌ **チーム分裂**: 手法選択でチーム内対立が発生
- ❌ **継続性欠如**: 分析後の継続的改善を怠る

### 各案の併用指針
- **案2は基本**: ほぼ全てのプロジェクトで案2を基本とする
- **案1で補強**: ドメインロジック複雑化時に案1要素を追加
- **案3で可視化**: 複雑な関係性がある場合に案3で補完
- **案4で現代化**: 分散・非同期が必要な場合に案4を適用
- **案5で品質**: 品質・監査が重要な場合に案5で強化

各案の詳細は個別ファイルを参照し、プロジェクトの特性・チーム体制・ビジネス要件に合わせて最適な選択・組み合わせを行ってください。