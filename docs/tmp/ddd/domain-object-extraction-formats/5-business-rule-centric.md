# æ¡ˆ5: ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ä¸­å¿ƒåˆ†æå‹

## ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¦‚è¦

ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãƒ»åˆ¶ç´„ãƒ»ä¸å¤‰æ¡ä»¶ã‚’æœ€å„ªå…ˆã¨ã—ã¦ã€ãã‚Œã‚‰ã‚’å®Ÿç¾ãƒ»ä¿è¨¼ã™ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç‰¹å®šã™ã‚‹æ‰‹æ³•ã€‚ãƒ«ãƒ¼ãƒ«ã®è²¬ä»»æ‰€åœ¨ã‚’æ˜ç¢ºåŒ–ã—ã€ãƒ«ãƒ¼ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ãƒ»å„ªå…ˆåº¦ã‚’åˆ†æã—ã¦é›†ç´„å¢ƒç•Œã‚’è¨­å®šã€‚

## æ§‹æˆ

```markdown
# ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŠ½å‡ºãƒ»åˆ†æï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ä¸­å¿ƒï¼‰

## ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«æ´—ã„å‡ºã—
### specificationsåˆ†æã‹ã‚‰ã®ãƒ«ãƒ¼ãƒ«æŠ½å‡º
### ãƒ«ãƒ¼ãƒ«ã®åˆ†é¡ï¼ˆåˆ¶ç´„ãƒ»ä¸å¤‰æ¡ä»¶ãƒ»æ¥­å‹™ãƒ•ãƒ­ãƒ¼ãƒ»è¨ˆç®—ãƒ«ãƒ¼ãƒ«ï¼‰

## ãƒ«ãƒ¼ãƒ«è²¬ä»»åˆ†æ
### ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚‹è²¬ä»»è€…ã®ç‰¹å®š
### ãƒ«ãƒ¼ãƒ«æ¤œè¨¼ãƒ»å®Ÿè¡Œã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

## ãƒ«ãƒ¼ãƒ«é–“é–¢ä¿‚åˆ†æ
### ãƒ«ãƒ¼ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ãƒ»å„ªå…ˆåº¦
### ç«¶åˆãƒ»çŸ›ç›¾ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã®ç‰¹å®š

## é›†ç´„å¢ƒç•Œè¨­å®š
### ä¸å¤‰æ¡ä»¶ã‹ã‚‰è¦‹ãŸé›†ç´„è¨­è¨ˆ
### ãƒ«ãƒ¼ãƒ«æ•´åˆæ€§ä¿è¨¼ã®ç¯„å›²

## ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŠ½å‡º
### ãƒ«ãƒ¼ãƒ«å®Ÿç¾ã®ãŸã‚ã«å¿…è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
### ãƒ«ãƒ¼ãƒ«æ¤œè¨¼ãƒ»å®Ÿè¡Œã®è²¬ä»»åˆ†æ•£
```

## ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…

```markdown
# ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŠ½å‡ºãƒ»åˆ†æï¼ˆãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ä¸­å¿ƒï¼‰

## ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«æ´—ã„å‡ºã—

### specificationsåˆ†æã‹ã‚‰ã®ãƒ«ãƒ¼ãƒ«æŠ½å‡º
**åˆ†æå¯¾è±¡**: user-stories, requirements, success-scenarios

| ãƒ«ãƒ¼ãƒ«ID | ãƒ«ãƒ¼ãƒ«å | å†…å®¹ | ç™ºè¦‹ç®‡æ‰€ | åˆ†é¡ | é‡è¦åº¦ |
|----------|----------|------|----------|------|--------|
| **BR001** | å•é¡Œæ–‡æ–‡å­—æ•°åˆ¶é™ | å•é¡Œæ–‡ã¯500æ–‡å­—ä»¥å†… | requirements#L11 | åˆ¶ç´„ | ğŸ”´ é«˜ |
| **BR002** | è§£èª¬æ–‡å­—æ•°åˆ¶é™ | è§£èª¬ã¯1000æ–‡å­—ä»¥å†… | requirements#L13 | åˆ¶ç´„ | ğŸŸ¡ ä¸­ |
| **BR003** | æ­£è§£å½¢å¼åˆ¶é™ | æ­£è§£ã¯â—¯Ã—ã®2æŠã®ã¿ | requirements#L12 | åˆ¶ç´„ | ğŸ”´ é«˜ |
| **BR004** | æ‰¿èªå¿…é ˆ | ã‚¯ã‚¤ã‚ºã¯ç®¡ç†è€…æ‰¿èªå¾Œã®ã¿å…¬é–‹ | requirements#L20 | æ¥­å‹™ãƒ•ãƒ­ãƒ¼ | ğŸ”´ æœ€é«˜ |
| **BR005** | åŒ¿åè­˜åˆ¥ | ä½œæˆè€…ã¯saltä»˜ããƒãƒƒã‚·ãƒ¥ã§è­˜åˆ¥ | requirements#L22 | åˆ¶ç´„ | ğŸ”´ é«˜ |
| **BR006** | é‡è¤‡æŠ•ç¨¿è¨±å¯ | åŒä¸€ä½œæˆè€…ãƒ»åŒä¸€å•é¡Œã§ã‚‚æŠ•ç¨¿å¯èƒ½ | requirements#L15 | æ¥­å‹™ãƒ•ãƒ­ãƒ¼ | ğŸŸ¡ ä¸­ |
| **BR007** | HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚º | å…¥åŠ›å†…å®¹ã®HTMLã‚¿ã‚°é™¤å»å¿…é ˆ | requirements#L16 | åˆ¶ç´„ | ğŸ”´ é«˜ |
| **BR008** | ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œå½¢å¼ | å³=â—¯ã€å·¦=Ã—ã®ã‚¹ãƒ¯ã‚¤ãƒ—ã®ã¿ | requirements#L41 | åˆ¶ç´„ | ğŸ”´ é«˜ |
| **BR009** | å±¥æ­´æ°¸ç¶šåŒ– | å›ç­”å±¥æ­´ã¯indexedDBã«æ°¸ç¶šä¿å­˜ | success#L24 | åˆ¶ç´„ | ğŸŸ¡ ä¸­ |
| **BR010** | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç¶™ç¶š | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ–­ç·šæ™‚ã‚‚å‹•ä½œç¶™ç¶š | success#L70 | æ¥­å‹™ãƒ•ãƒ­ãƒ¼ | ğŸŸ¡ ä¸­ |
| **BR011** | ç®¡ç†è€…æ¨©é™ | æ‰¿èªãƒ»æ‹’å¦ã¯ç®¡ç†è€…ã®ã¿å®Ÿè¡Œå¯èƒ½ | requirements#L20 | åˆ¶ç´„ | ğŸ”´ æœ€é«˜ |
| **BR012** | æ‰¿èªæ¸ˆã¿å›ç­”åˆ¶é™ | æ‰¿èªæ¸ˆã¿ã‚¯ã‚¤ã‚ºã®ã¿å›ç­”å¯èƒ½ | success#L8 | ä¸å¤‰æ¡ä»¶ | ğŸ”´ æœ€é«˜ |

### ãƒ«ãƒ¼ãƒ«ã®åˆ†é¡

#### åˆ¶ç´„ãƒ«ãƒ¼ãƒ«ï¼ˆConstraint Rulesï¼‰- ãƒ‡ãƒ¼ã‚¿å“è³ªä¿è¨¼
- **BR001**: å•é¡Œæ–‡æ–‡å­—æ•°åˆ¶é™ï¼ˆ500æ–‡å­—ï¼‰
- **BR002**: è§£èª¬æ–‡å­—æ•°åˆ¶é™ï¼ˆ1000æ–‡å­—ï¼‰
- **BR003**: æ­£è§£å½¢å¼åˆ¶é™ï¼ˆâ—¯Ã—2æŠï¼‰
- **BR005**: åŒ¿åè­˜åˆ¥ï¼ˆsaltä»˜ããƒãƒƒã‚·ãƒ¥ï¼‰
- **BR007**: HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆXSSå¯¾ç­–ï¼‰
- **BR008**: ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œå½¢å¼ï¼ˆå³â—¯å·¦Ã—ï¼‰
- **BR009**: å±¥æ­´æ°¸ç¶šåŒ–ï¼ˆindexedDBï¼‰
- **BR011**: ç®¡ç†è€…æ¨©é™ï¼ˆæ‰¿èªãƒ»æ‹’å¦æ¨©é™ï¼‰

#### ä¸å¤‰æ¡ä»¶ï¼ˆInvariant Rulesï¼‰- ã‚·ã‚¹ãƒ†ãƒ æ•´åˆæ€§ä¿è¨¼
- **BR004**: æ‰¿èªå¿…é ˆï¼ˆå…¬é–‹å‰æ‰¿èªå¿…è¦ï¼‰
- **BR012**: æ‰¿èªæ¸ˆã¿å›ç­”åˆ¶é™ï¼ˆæœªæ‰¿èªã¸ã®å›ç­”ç¦æ­¢ï¼‰

#### æ¥­å‹™ãƒ•ãƒ­ãƒ¼ãƒ¼ãƒ«ãƒ¼ãƒ«ï¼ˆBusiness Flow Rulesï¼‰- ãƒ—ãƒ­ã‚»ã‚¹åˆ¶å¾¡
- **BR006**: é‡è¤‡æŠ•ç¨¿è¨±å¯ï¼ˆåŒä¸€å•é¡Œã®è¤‡æ•°æŠ•ç¨¿ï¼‰
- **BR010**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç¶™ç¶šï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç‹¬ç«‹å‹•ä½œï¼‰

#### è¨ˆç®—ãƒ«ãƒ¼ãƒ«ï¼ˆCalculation Rulesï¼‰- å€¤ã®å°å‡º
- ï¼ˆã‚¯ã‚¤ã‚ºã‚¢ãƒ—ãƒªã§ã¯è©²å½“ãªã—ã€å°†æ¥çš„ã«æ­£ç­”ç‡è¨ˆç®—ç­‰ï¼‰

## ãƒ«ãƒ¼ãƒ«è²¬ä»»åˆ†æ

### ãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚‹è²¬ä»»è€…ã®ç‰¹å®š

#### BR001: å•é¡Œæ–‡æ–‡å­—æ•°åˆ¶é™ï¼ˆ500æ–‡å­—ä»¥å†…ï¼‰
**è²¬ä»»è€…**: `Question`å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
**æ¤œè¨¼ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆæ™‚
**å®Ÿè¡Œå ´æ‰€**: `Question.create()` ãƒ¡ã‚½ãƒƒãƒ‰
**é•åæ™‚ã®å‹•ä½œ**: `ValidationError` ä¾‹å¤–ç™ºç”Ÿ

```typescript
class Question {
  private constructor(private readonly text: string) {
    this.validateLength(); // BR001å®Ÿè¡Œ
  }
  
  public static create(text: string): Question {
    return new Question(text); // ã“ã“ã§æ¤œè¨¼å®Ÿè¡Œ
  }
  
  private validateLength(): void {
    if (this.text.length > 500) {
      throw new ValidationError('å•é¡Œæ–‡ã¯500æ–‡å­—ä»¥å†…ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
    }
  }
}
```

#### BR004: æ‰¿èªå¿…é ˆï¼ˆç®¡ç†è€…æ‰¿èªå¾Œã®ã¿å…¬é–‹ï¼‰

**è²¬ä»»è€…**: `Quiz`ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ + `ApprovalService`
**æ¤œè¨¼ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: å…¬é–‹æ™‚ã€å›ç­”æ™‚
**å®Ÿè¡Œå ´æ‰€**: `Quiz.isAvailableForAnswer()`, `ApprovalService.approve()`
**é•åæ™‚ã®å‹•ä½œ**: å…¬é–‹æ‹’å¦ã€å›ç­”æ‹’å¦

```typescript
class Quiz {
  public isAvailableForAnswer(): boolean {
    return this.status === QuizStatus.Approved; // BR004 & BR012å®Ÿè¡Œ
  }
  
  public approve(administrator: Administrator): void {
    this.validateAdministratorPermission(administrator); // BR011å®Ÿè¡Œ
    this.status = QuizStatus.Approved; // BR004å®Ÿç¾
  }
}

class ApprovalService {
  public approve(quizId: QuizId, administrator: Administrator): void {
    const quiz = this.quizRepository.findById(quizId);
    quiz.approve(administrator); // BR004 & BR011å®Ÿè¡Œ
    this.quizRepository.save(quiz);
  }
}
```

#### BR005: åŒ¿åè­˜åˆ¥ï¼ˆsaltä»˜ããƒãƒƒã‚·ãƒ¥ï¼‰

**è²¬ä»»è€…**: `CreatorId`å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ + `CreatorIdentificationService`
**æ¤œè¨¼ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ä½œæˆè€…è­˜åˆ¥æ™‚
**å®Ÿè¡Œå ´æ‰€**: `CreatorId.generate()`, `CreatorIdentificationService.identify()`
**é•åæ™‚ã®å‹•ä½œ**: è­˜åˆ¥å¤±æ•—ã€ä½œæˆæ¨©é™ãªã—

```typescript
class CreatorId {
  private constructor(private readonly hashedValue: string) {}
  
  public static generate(deviceInfo: DeviceInfo, salt: string): CreatorId {
    const hash = this.generateSaltedHash(deviceInfo, salt); // BR005å®Ÿè¡Œ
    return new CreatorId(hash);
  }
  
  private static generateSaltedHash(deviceInfo: DeviceInfo, salt: string): string {
    // saltä»˜ããƒãƒƒã‚·ãƒ¥ç”Ÿæˆï¼ˆBR005ã®å…·ä½“çš„å®Ÿè£…ï¼‰
    return sha256(deviceInfo.toString() + salt);
  }
}
```

#### BR008: ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œå½¢å¼ï¼ˆå³â—¯å·¦Ã—ï¼‰

**è²¬ä»»è€…**: `SwipeGesture`å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
**æ¤œè¨¼ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ã‚¹ãƒ¯ã‚¤ãƒ—æ¤œå‡ºæ™‚
**å®Ÿè¡Œå ´æ‰€**: `SwipeGesture.interpret()`
**é•åæ™‚ã®å‹•ä½œ**: æ“ä½œç„¡åŠ¹åŒ–

```typescript
class SwipeGesture {
  public interpret(): boolean {
    // BR008å®Ÿè¡Œï¼šå³=true(â—¯)ã€å·¦=false(Ã—)
    if (this.direction === SwipeDirection.Right) {
      return true; // â—¯
    } else if (this.direction === SwipeDirection.Left) {
      return false; // Ã—
    } else {
      throw new InvalidOperationError('æœ‰åŠ¹ãªã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œã§ã¯ã‚ã‚Šã¾ã›ã‚“');
    }
  }
}
```

### ãƒ«ãƒ¼ãƒ«æ¤œè¨¼ãƒ»å®Ÿè¡Œã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°

#### ã‚¿ã‚¤ãƒŸãƒ³ã‚°åˆ†é¡

##### 1. ç”Ÿæˆæ™‚æ¤œè¨¼ï¼ˆCreation Timeï¼‰

- **BR001**: å•é¡Œæ–‡æ–‡å­—æ•°åˆ¶é™
- **BR002**: è§£èª¬æ–‡å­—æ•°åˆ¶é™
- **BR003**: æ­£è§£å½¢å¼åˆ¶é™
- **BR005**: åŒ¿åè­˜åˆ¥
- **BR007**: HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚º

##### 2. çŠ¶æ…‹å¤‰æ›´æ™‚æ¤œè¨¼ï¼ˆState Change Timeï¼‰

- **BR004**: æ‰¿èªå¿…é ˆï¼ˆçŠ¶æ…‹å¤‰æ›´æ™‚ï¼‰
- **BR011**: ç®¡ç†è€…æ¨©é™ï¼ˆæ‰¿èªæ“ä½œæ™‚ï¼‰

##### 3. åˆ©ç”¨æ™‚æ¤œè¨¼ï¼ˆUsage Timeï¼‰

- **BR012**: æ‰¿èªæ¸ˆã¿å›ç­”åˆ¶é™ï¼ˆå›ç­”æ™‚ï¼‰
- **BR008**: ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œå½¢å¼ï¼ˆæ“ä½œæ™‚ï¼‰

##### 4. ç¶™ç¶šçš„æ¤œè¨¼ï¼ˆContinuousï¼‰

- **BR009**: å±¥æ­´æ°¸ç¶šåŒ–ï¼ˆãƒ‡ãƒ¼ã‚¿ä¿å­˜æ™‚ï¼‰
- **BR010**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç¶™ç¶šï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ…‹å¤‰åŒ–æ™‚ï¼‰

## ãƒ«ãƒ¼ãƒ«é–“é–¢ä¿‚åˆ†æ

### ãƒ«ãƒ¼ãƒ«é–“ã®ä¾å­˜é–¢ä¿‚ãƒ»å„ªå…ˆåº¦

#### ä¾å­˜é–¢ä¿‚ãƒãƒƒãƒ—

```mermaid
graph TD
    BR005[åŒ¿åè­˜åˆ¥] --> BR006[é‡è¤‡æŠ•ç¨¿è¨±å¯]
    BR004[æ‰¿èªå¿…é ˆ] --> BR012[æ‰¿èªæ¸ˆã¿å›ç­”åˆ¶é™]
    BR011[ç®¡ç†è€…æ¨©é™] --> BR004[æ‰¿èªå¿…é ˆ]
    BR001[å•é¡Œæ–‡åˆ¶é™] --> BR007[HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚º]
    BR002[è§£èª¬åˆ¶é™] --> BR007[HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚º]
    BR008[ã‚¹ãƒ¯ã‚¤ãƒ—å½¢å¼] --> BR012[æ‰¿èªæ¸ˆã¿å›ç­”åˆ¶é™]
    BR009[å±¥æ­´æ°¸ç¶šåŒ–] --> BR010[ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç¶™ç¶š]
```

#### å„ªå…ˆåº¦éšå±¤

##### Tier 1: ã‚·ã‚¹ãƒ†ãƒ æ•´åˆæ€§ï¼ˆæœ€é«˜å„ªå…ˆåº¦ï¼‰

- **BR004**: æ‰¿èªå¿…é ˆ
- **BR011**: ç®¡ç†è€…æ¨©é™
- **BR012**: æ‰¿èªæ¸ˆã¿å›ç­”åˆ¶é™

##### Tier 2: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»å“è³ªï¼ˆé«˜å„ªå…ˆåº¦ï¼‰

- **BR001**: å•é¡Œæ–‡æ–‡å­—æ•°åˆ¶é™
- **BR003**: æ­£è§£å½¢å¼åˆ¶é™
- **BR005**: åŒ¿åè­˜åˆ¥
- **BR007**: HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚º
- **BR008**: ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œå½¢å¼

##### Tier 3: ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£ãƒ»åˆ©ä¾¿æ€§ï¼ˆä¸­å„ªå…ˆåº¦ï¼‰

- **BR002**: è§£èª¬æ–‡å­—æ•°åˆ¶é™
- **BR006**: é‡è¤‡æŠ•ç¨¿è¨±å¯
- **BR009**: å±¥æ­´æ°¸ç¶šåŒ–
- **BR010**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç¶™ç¶š

### ç«¶åˆãƒ»çŸ›ç›¾ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã®ç‰¹å®š

#### æ½œåœ¨çš„ç«¶åˆãƒ«ãƒ¼ãƒ«

##### ç«¶åˆ1: é‡è¤‡æŠ•ç¨¿è¨±å¯ vs å“è³ªç®¡ç†

- **BR006**: é‡è¤‡æŠ•ç¨¿è¨±å¯ï¼ˆåŒä¸€å•é¡Œã®è¤‡æ•°æŠ•ç¨¿ã‚’è¨±å¯ï¼‰
- **BR004**: æ‰¿èªå¿…é ˆï¼ˆå“è³ªç®¡ç†ã®ãŸã‚æ‰¿èªãŒå¿…è¦ï¼‰
- **ç«¶åˆå†…å®¹**: é‡è¤‡æŠ•ç¨¿ã«ã‚ˆã‚Šæ‰¿èªè² è·ãŒå¢—åŠ 
- **è§£æ±ºæ–¹é‡**: æ‰¿èªæ™‚ã«é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã€æ˜ã‚‰ã‹ãªé‡è¤‡ã¯æ‹’å¦

##### ç«¶åˆ2: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç¶™ç¶š vs æ‰¿èªæ¸ˆã¿åˆ¶é™

- **BR010**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç¶™ç¶šï¼ˆãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ–­ç·šæ™‚ã‚‚å‹•ä½œï¼‰
- **BR012**: æ‰¿èªæ¸ˆã¿å›ç­”åˆ¶é™ï¼ˆæ‰¿èªæ¸ˆã¿ã®ã¿å›ç­”å¯èƒ½ï¼‰
- **ç«¶åˆå†…å®¹**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã¯æœ€æ–°ã®æ‰¿èªçŠ¶æ…‹ã‚’ç¢ºèªã§ããªã„
- **è§£æ±ºæ–¹é‡**: äº‹å‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ™‚ã«æ‰¿èªæ¸ˆã¿ã‚¯ã‚¤ã‚ºã®ã¿ã‚’å¯¾è±¡ã¨ã™ã‚‹

##### ç«¶åˆ3: åŒ¿åè­˜åˆ¥ vs å±¥æ­´æ°¸ç¶šåŒ–

- **BR005**: åŒ¿åè­˜åˆ¥ï¼ˆãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ï¼‰
- **BR009**: å±¥æ­´æ°¸ç¶šåŒ–ï¼ˆå­¦ç¿’è¨˜éŒ²ä¿æŒï¼‰
- **ç«¶åˆå†…å®¹**: åŒ¿åæ€§ã¨å±¥æ­´ã®æ°¸ç¶šåŒ–ã®ãƒãƒ©ãƒ³ã‚¹
- **è§£æ±ºæ–¹é‡**: ãƒ‡ãƒã‚¤ã‚¹ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®å±¥æ­´ä¿å­˜ã€å€‹äººç‰¹å®šä¸å¯èƒ½ãªå½¢å¼

## é›†ç´„å¢ƒç•Œè¨­å®š

### ä¸å¤‰æ¡ä»¶ã‹ã‚‰è¦‹ãŸé›†ç´„è¨­è¨ˆ

#### é›†ç´„1: Quizé›†ç´„

**ä¿è­·ã™ã‚‹ä¸å¤‰æ¡ä»¶**:

- **BR001**: å•é¡Œæ–‡ã¯500æ–‡å­—ä»¥å†…
- **BR002**: è§£èª¬ã¯1000æ–‡å­—ä»¥å†…
- **BR003**: æ­£è§£ã¯â—¯Ã—ã®2æŠ
- **BR004**: æ‰¿èªçŠ¶æ…‹ã®æ•´åˆæ€§
- **BR007**: å…¥åŠ›å†…å®¹ã®ã‚µãƒ‹ã‚¿ã‚¤ã‚º

**é›†ç´„å¢ƒç•Œã®æ ¹æ‹ **:

- ã“ã‚Œã‚‰ã®ãƒ«ãƒ¼ãƒ«ã¯å¯†æ¥ã«é–¢é€£ã—ã€åŒæ™‚ã«æº€ãŸã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹
- Quizä½œæˆãƒ»æ›´æ–°æ™‚ã«ä¸€è²«ã—ã¦æ¤œè¨¼ãŒå¿…è¦
- ä»–ã®é›†ç´„ã‹ã‚‰ã¯å‚ç…§ã®ã¿ã€å¤‰æ›´ã¯ä¸å¯

```typescript
class QuizAggregate {
  private quiz: Quiz;
  private question: Question;
  private correctAnswer: CorrectAnswer;
  private explanation?: Explanation;
  private tags: Tag[];
  
  public create(quizData: CreateQuizData, creator: CreatorId): void {
    // BR001, BR002, BR003, BR007ã‚’åŒæ™‚å®Ÿè¡Œ
    this.question = Question.create(quizData.question); // BR001, BR007
    this.correctAnswer = CorrectAnswer.create(quizData.correctAnswer); // BR003
    this.explanation = quizData.explanation 
      ? Explanation.create(quizData.explanation) // BR002, BR007
      : undefined;
    
    this.quiz = Quiz.create({
      question: this.question,
      correctAnswer: this.correctAnswer,
      explanation: this.explanation,
      tags: this.tags,
      creator: creator,
      status: QuizStatus.PendingApproval // BR004
    });
  }
  
  public approve(administrator: Administrator): void {
    // BR004, BR011ã‚’åŒæ™‚å®Ÿè¡Œ
    this.quiz.validateAdministratorPermission(administrator); // BR011
    this.quiz.approve(); // BR004
  }
}
```

#### é›†ç´„2: LearningSessioné›†ç´„

**ä¿è­·ã™ã‚‹ä¸å¤‰æ¡ä»¶**:

- **BR008**: ã‚¹ãƒ¯ã‚¤ãƒ—æ“ä½œå½¢å¼ï¼ˆå³â—¯å·¦Ã—ï¼‰
- **BR009**: å±¥æ­´æ°¸ç¶šåŒ–
- **BR010**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ç¶™ç¶šæ€§
- **BR012**: æ‰¿èªæ¸ˆã¿ã‚¯ã‚¤ã‚ºã®ã¿å›ç­”å¯èƒ½

**é›†ç´„å¢ƒç•Œã®æ ¹æ‹ **:

- å­¦ç¿’ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ã®å›ç­”ã®æ•´åˆæ€§ä¿è¨¼
- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã§ã®ä¸€è²«ã—ãŸå‹•ä½œ
- ã‚»ãƒƒã‚·ãƒ§ãƒ³å˜ä½ã§ã®å±¥æ­´ç®¡ç†

```typescript
class LearningSessionAggregate {
  private session: Session;
  private answerHistory: AnswerHistory;
  private offlineMode: OfflineMode;
  
  public processAnswer(
    gesture: SwipeGesture, 
    quiz: Quiz, 
    timestamp: Date
  ): AnswerResult {
    // BR008: ã‚¹ãƒ¯ã‚¤ãƒ—å½¢å¼æ¤œè¨¼
    const userAnswer = gesture.interpret(); // BR008å®Ÿè¡Œ
    
    // BR012: æ‰¿èªæ¸ˆã¿ã‚¯ã‚¤ã‚ºç¢ºèª
    if (!quiz.isAvailableForAnswer()) { // BR012å®Ÿè¡Œ
      throw new BusinessRuleViolationError('æ‰¿èªæ¸ˆã¿ã‚¯ã‚¤ã‚ºã®ã¿å›ç­”å¯èƒ½ã§ã™');
    }
    
    // å›ç­”è¨˜éŒ²
    const answer = Answer.create({
      quizId: quiz.id,
      userAnswer: userAnswer,
      isCorrect: quiz.judge(userAnswer),
      answeredAt: timestamp
    });
    
    // BR009: å±¥æ­´æ°¸ç¶šåŒ–
    this.answerHistory.addAnswer(answer); // BR009å®Ÿè¡Œ
    this.persistHistory(); // BR009å®Ÿè¡Œ
    
    return new AnswerResult(answer, quiz);
  }
  
  private persistHistory(): void {
    // BR009, BR010: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã‚‚å«ã‚ãŸæ°¸ç¶šåŒ–
    if (this.offlineMode.isOnline()) {
      this.syncToRemote();
    }
    this.saveToLocal(); // BR009å®Ÿè¡Œ
  }
}
```

#### é›†ç´„3: Identityé›†ç´„

**ä¿è­·ã™ã‚‹ä¸å¤‰æ¡ä»¶**:

- **BR005**: åŒ¿åè­˜åˆ¥ï¼ˆsaltä»˜ããƒãƒƒã‚·ãƒ¥ï¼‰
- **BR006**: é‡è¤‡æŠ•ç¨¿è¨±å¯ï¼ˆåŒä¸€ä½œæˆè€…ã®è­˜åˆ¥ï¼‰

**é›†ç´„å¢ƒç•Œã®æ ¹æ‹ **:

- ä½œæˆè€…ã®è­˜åˆ¥æƒ…å ±ã®ä¸€æ„æ€§ãƒ»åŒ¿åæ€§ä¿è¨¼
- ãƒ‡ãƒã‚¤ã‚¹å¤‰æ›´æ™‚ã®ç¶™ç¶šæ€§åˆ¶å¾¡

```typescript
class IdentityAggregate {
  private creator: Creator;
  private creatorId: CreatorId;
  private deviceInfo: DeviceInfo;
  
  public generateCreatorIdentity(deviceInfo: DeviceInfo): CreatorId {
    // BR005: saltä»˜ããƒãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹åŒ¿åè­˜åˆ¥
    const salt = this.generateSalt();
    const creatorId = CreatorId.generate(deviceInfo, salt); // BR005å®Ÿè¡Œ
    
    this.creator = Creator.create(creatorId, deviceInfo);
    this.creatorId = creatorId;
    this.deviceInfo = deviceInfo;
    
    return creatorId;
  }
  
  public canSubmitQuiz(quizData: QuizData): boolean {
    // BR006: é‡è¤‡æŠ•ç¨¿è¨±å¯ã®ç¢ºèª
    // åŒä¸€ä½œæˆè€…ã«ã‚ˆã‚‹åŒä¸€å•é¡Œã§ã‚‚æŠ•ç¨¿å¯èƒ½
    return true; // BR006ã«ã‚ˆã‚Šå¸¸ã«è¨±å¯
  }
}
```

### ãƒ«ãƒ¼ãƒ«æ•´åˆæ€§ä¿è¨¼ã®ç¯„å›²

#### é›†ç´„å†…æ•´åˆæ€§ï¼ˆStrong Consistencyï¼‰

- **åŒä¸€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…**ã§å…¨ãƒ«ãƒ¼ãƒ«ã‚’æ¤œè¨¼ãƒ»å®Ÿè¡Œ
- **å³åº§ã®æ•´åˆæ€§**ä¿è¨¼
- **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯**ã«ã‚ˆã‚‹åŸå­æ€§ç¢ºä¿

#### é›†ç´„é–“æ•´åˆæ€§ï¼ˆEventual Consistencyï¼‰

- **ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆ**ã«ã‚ˆã‚‹çµæœæ•´åˆæ€§
- **ã‚µãƒ¼ã‚¬ãƒ‘ã‚¿ãƒ¼ãƒ³**ã«ã‚ˆã‚‹é•·æœŸå®Ÿè¡Œãƒ—ãƒ­ã‚»ã‚¹
- **è£œå„Ÿã‚¢ã‚¯ã‚·ãƒ§ãƒ³**ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼æ™‚å¾©æ—§

```typescript
// é›†ç´„å†…æ•´åˆæ€§ã®ä¾‹
class QuizAggregate {
  public create(quizData: CreateQuizData): void {
    const transaction = this.startTransaction();
    
    try {
      // BR001, BR002, BR003, BR007ã‚’åŒæ™‚å®Ÿè¡Œ
      this.validateAllRules(quizData);
      this.createQuizEntity(quizData);
      
      transaction.commit(); // å…¨ãƒ«ãƒ¼ãƒ«æˆåŠŸæ™‚ã®ã¿ã‚³ãƒŸãƒƒãƒˆ
    } catch (error) {
      transaction.rollback(); // 1ã¤ã§ã‚‚å¤±æ•—æ™‚ã¯ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
      throw error;
    }
  }
}

// é›†ç´„é–“æ•´åˆæ€§ã®ä¾‹
class QuizApprovalSaga {
  public async handleQuizApproved(event: QuizApprovedEvent): Promise<void> {
    try {
      // ä»–é›†ç´„ã¸ã®å½±éŸ¿ï¼ˆçµæœæ•´åˆæ€§ï¼‰
      await this.updatePublicQuizList(event.quizId);
      await this.notifyCreator(event.creatorId);
      await this.updateStatistics(event.quizId);
    } catch (error) {
      // è£œå„Ÿã‚¢ã‚¯ã‚·ãƒ§ãƒ³
      await this.revertQuizApproval(event.quizId);
    }
  }
}
```

## ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŠ½å‡º

### ãƒ«ãƒ¼ãƒ«å®Ÿç¾ã®ãŸã‚ã«å¿…è¦ãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

#### ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆRule Executorsï¼‰

| ãƒ«ãƒ¼ãƒ«ID | å®Ÿè¡Œã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | è²¬ä»» | ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ |
|----------|----------------|------|-----------------|
| **BR001-BR003** | Question, CorrectAnswer, Explanation | å…¥åŠ›å€¤åˆ¶ç´„å®Ÿè¡Œ | `validate(): ValidationResult` |
| **BR004** | Quiz, ApprovalService | æ‰¿èªçŠ¶æ…‹ç®¡ç† | `approve(): void`, `isApproved(): boolean` |
| **BR005** | CreatorId, CreatorIdentificationService | åŒ¿åè­˜åˆ¥å®Ÿè¡Œ | `generate(): CreatorId`, `verify(): boolean` |
| **BR007** | InputSanitizer | HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚ºå®Ÿè¡Œ | `sanitize(input: string): string` |
| **BR008** | SwipeGesture | ã‚¹ãƒ¯ã‚¤ãƒ—è§£é‡ˆå®Ÿè¡Œ | `interpret(): boolean` |
| **BR009** | AnswerHistory, PersistenceService | å±¥æ­´æ°¸ç¶šåŒ–å®Ÿè¡Œ | `persist(): void`, `restore(): AnswerHistory` |

#### ãƒ«ãƒ¼ãƒ«æ¤œè¨¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆRule Validatorsï¼‰

| ãƒ«ãƒ¼ãƒ«ã‚«ãƒ†ã‚´ãƒª | æ¤œè¨¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | è²¬ä»» | æ¤œè¨¼ã‚¿ã‚¤ãƒŸãƒ³ã‚° |
|-------------|-----------------|------|---------------|
| **åˆ¶ç´„ãƒ«ãƒ¼ãƒ«** | ConstraintValidator | å€¤ãƒ»å½¢å¼ã®åˆ¶ç´„ãƒã‚§ãƒƒã‚¯ | å€¤ç”Ÿæˆæ™‚ |
| **ä¸å¤‰æ¡ä»¶** | InvariantChecker | ã‚·ã‚¹ãƒ†ãƒ æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ | çŠ¶æ…‹å¤‰æ›´å‰å¾Œ |
| **æ¥­å‹™ãƒ•ãƒ­ãƒ¼** | BusinessFlowValidator | ãƒ—ãƒ­ã‚»ã‚¹æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯ | å‡¦ç†å®Ÿè¡Œå‰ |
| **æ¨©é™ãƒ«ãƒ¼ãƒ«** | PermissionChecker | æ¨©é™ãƒ»èªå¯ãƒã‚§ãƒƒã‚¯ | æ“ä½œå®Ÿè¡Œå‰ |

```typescript
// åˆ¶ç´„ãƒ«ãƒ¼ãƒ«æ¤œè¨¼
class ConstraintValidator {
  public validateQuestion(text: string): ValidationResult {
    const results: ValidationResult[] = [];
    
    // BR001: æ–‡å­—æ•°åˆ¶é™
    if (text.length > 500) {
      results.push(ValidationResult.error('å•é¡Œæ–‡ã¯500æ–‡å­—ä»¥å†…'));
    }
    
    // BR007: HTMLã‚µãƒ‹ã‚¿ã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
    if (this.containsHtmlTags(text)) {
      results.push(ValidationResult.warning('HTMLã‚¿ã‚°ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ'));
    }
    
    return ValidationResult.combine(results);
  }
}

// ä¸å¤‰æ¡ä»¶ãƒã‚§ãƒƒã‚¯
class InvariantChecker {
  public checkQuizApprovalInvariant(quiz: Quiz): InvariantResult {
    // BR004 & BR012: æ‰¿èªçŠ¶æ…‹ã®æ•´åˆæ€§
    if (quiz.isPublic() && !quiz.isApproved()) {
      return InvariantResult.violation('æœªæ‰¿èªã‚¯ã‚¤ã‚ºã¯å…¬é–‹ã§ãã¾ã›ã‚“');
    }
    
    return InvariantResult.satisfied();
  }
}

// æ¥­å‹™ãƒ•ãƒ­ãƒ¼æ¤œè¨¼
class BusinessFlowValidator {
  public validateQuizSubmissionFlow(
    creator: Creator, 
    quizData: QuizData
  ): FlowValidationResult {
    // BR006: é‡è¤‡æŠ•ç¨¿è¨±å¯ã®ç¢ºèª
    const duplicateAllowed = this.checkDuplicateSubmissionAllowed(creator, quizData);
    
    if (!duplicateAllowed.isAllowed && duplicateAllowed.strictMode) {
      return FlowValidationResult.blocked('é‡è¤‡æŠ•ç¨¿ã¯è¨±å¯ã•ã‚Œã¦ã„ã¾ã›ã‚“');
    }
    
    return FlowValidationResult.allowed();
  }
}
```

### ãƒ«ãƒ¼ãƒ«æ¤œè¨¼ãƒ»å®Ÿè¡Œã®è²¬ä»»åˆ†æ•£

#### è²¬ä»»åˆ†æ•£ã®åŸå‰‡

##### 1. å˜ä¸€è²¬ä»»ã®åŸå‰‡ï¼ˆSingle Responsibilityï¼‰

- å„ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯1ã¤ã®ãƒ«ãƒ¼ãƒ«ã‚«ãƒ†ã‚´ãƒªã®ã¿æ‹…å½“
- ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œã¨æ¤œè¨¼ã®è²¬ä»»åˆ†é›¢
- å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯è‡ªèº«ã®åˆ¶ç´„ã®ã¿ä¿è¨¼

##### 2. ã‚ªãƒ¼ãƒ—ãƒ³ãƒ»ã‚¯ãƒ­ãƒ¼ã‚ºã®åŸå‰‡ï¼ˆOpen/Closedï¼‰

- æ–°ã—ã„ãƒ«ãƒ¼ãƒ«è¿½åŠ æ™‚ã¯æ‹¡å¼µã®ã¿ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ä¿®æ­£ãªã—ï¼‰
- ãƒ«ãƒ¼ãƒ«æ¤œè¨¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æ¨™æº–åŒ–
- ãƒ—ãƒ©ã‚¬ãƒ–ãƒ«ãªãƒ«ãƒ¼ãƒ«å®Ÿè¡Œæ©Ÿæ§‹

##### 3. ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ï¼ˆDependency Inversionï¼‰

- é«˜ãƒ¬ãƒ™ãƒ«ãƒ«ãƒ¼ãƒ«ï¼ˆæ¥­å‹™ãƒ•ãƒ­ãƒ¼ï¼‰ã¯ä½ãƒ¬ãƒ™ãƒ«ãƒ«ãƒ¼ãƒ«ï¼ˆåˆ¶ç´„ï¼‰ã«ä¾å­˜ã—ãªã„
- ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œè€…ã¯ãƒ«ãƒ¼ãƒ«å®šç¾©ã«ä¾å­˜ã€é€†ã¯ç¦æ­¢
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«ã‚ˆã‚‹ç–çµåˆ

#### å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

##### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œã®å§”è­²

```typescript
class Quiz {
  private constructor(
    private readonly question: Question,
    private readonly correctAnswer: CorrectAnswer,
    private status: QuizStatus
  ) {}
  
  public static create(data: CreateQuizData): Quiz {
    // åˆ¶ç´„ãƒ«ãƒ¼ãƒ«ã¯å€¤ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å§”è­²
    const question = Question.create(data.question); // BR001, BR007
    const correctAnswer = CorrectAnswer.create(data.correctAnswer); // BR003
    
    // æ¥­å‹™ãƒ•ãƒ­ãƒ¼ã¯ã‚µãƒ¼ãƒ“ã‚¹ã«å§”è­²
    const initialStatus = QuizCreationService.determineInitialStatus(); // BR004
    
    return new Quiz(question, correctAnswer, initialStatus);
  }
  
  public approve(administrator: Administrator): void {
    // æ¨©é™ãƒã‚§ãƒƒã‚¯ã¯ã‚µãƒ¼ãƒ“ã‚¹ã«å§”è­²
    PermissionService.checkApprovalPermission(administrator); // BR011
    
    // çŠ¶æ…‹å¤‰æ›´ã¯è‡ªèº«ãŒå®Ÿè¡Œ
    this.status = QuizStatus.Approved; // BR004
  }
}
```

##### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ãƒ«ãƒ¼ãƒ«æ¤œè¨¼ã®ãƒã‚§ãƒ¼ãƒ³

```typescript
class RuleValidationChain {
  private validators: RuleValidator[] = [];
  
  public addValidator(validator: RuleValidator): void {
    this.validators.push(validator);
  }
  
  public validate(target: any): ValidationResult {
    const results: ValidationResult[] = [];
    
    for (const validator of this.validators) {
      const result = validator.validate(target);
      results.push(result);
      
      // é«˜å„ªå…ˆåº¦ãƒ«ãƒ¼ãƒ«é•åæ™‚ã¯å³åº§ã«åœæ­¢
      if (result.isCriticalFailure()) {
        break;
      }
    }
    
    return ValidationResult.combine(results);
  }
}

// ä½¿ç”¨ä¾‹
const quizValidationChain = new RuleValidationChain();
quizValidationChain.addValidator(new ConstraintValidator()); // BR001-BR003
quizValidationChain.addValidator(new SecurityValidator()); // BR007
quizValidationChain.addValidator(new BusinessRuleValidator()); // BR004-BR006

const validationResult = quizValidationChain.validate(quiz);
```

##### ãƒ‘ã‚¿ãƒ¼ãƒ³3: ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œã®ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•

```typescript
class RuleExecutionEventBus {
  public async executeRule(ruleId: string, context: RuleExecutionContext): Promise<void> {
    const event = new RuleExecutionRequestedEvent(ruleId, context);
    await this.eventBus.publish(event);
  }
}

class BR004_ApprovalRuleHandler implements RuleExecutionHandler {
  public async handle(event: RuleExecutionRequestedEvent): Promise<void> {
    if (event.ruleId === 'BR004') {
      const quiz = event.context.target as Quiz;
      const administrator = event.context.actor as Administrator;
      
      // BR004: æ‰¿èªå¿…é ˆãƒ«ãƒ¼ãƒ«ã®å®Ÿè¡Œ
      quiz.approve(administrator);
      
      // å®Ÿè¡Œçµæœã®ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
      await this.eventBus.publish(new RuleExecutedEvent('BR004', quiz.id));
    }
  }
}
```

## å®Ÿè£…ã¸ã®ç¤ºå”†

### ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ä¸­å¿ƒè¨­è¨ˆã®åŸå‰‡

#### 1. ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

- **ãƒ«ãƒ¼ãƒ«å®šç¾©**ã‹ã‚‰è¨­è¨ˆã‚’é–‹å§‹
- **åˆ¶ç´„ã‹ã‚‰è²¬ä»»**ã¸ã®è‡ªç„¶ãªå°å‡º
- **ãƒ“ã‚¸ãƒã‚¹ä¾¡å€¤**ã¨ã®ç›´æ¥çš„ãªå¯¾å¿œ

#### 2. ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œã®å¯è¦–æ€§

- **ãƒ«ãƒ¼ãƒ«é•å**ã®æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œå±¥æ­´**ã®è¿½è·¡å¯èƒ½æ€§
- **ãƒ«ãƒ¼ãƒ«å¤‰æ›´**ã®å½±éŸ¿ç¯„å›²åˆ†æ

#### 3. ãƒ«ãƒ¼ãƒ«ã®é€²åŒ–å¯¾å¿œ

- **æ–°ãƒ«ãƒ¼ãƒ«è¿½åŠ **ã®å®¹æ˜“ã•
- **æ—¢å­˜ãƒ«ãƒ¼ãƒ«å¤‰æ›´**ã®å½±éŸ¿æœ€å°åŒ–
- **ãƒ«ãƒ¼ãƒ«é–“ç«¶åˆ**ã®æ—©æœŸç™ºè¦‹

### TypeScriptå®Ÿè£…ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

#### ãƒ«ãƒ¼ãƒ«è¡¨ç¾ã®å‹å®‰å…¨æ€§

```typescript
// ãƒ«ãƒ¼ãƒ«å®šç¾©ã®å‹å®‰å…¨æ€§
type BusinessRule<T> = {
  id: string;
  description: string;
  validate: (target: T) => ValidationResult;
  execute?: (target: T) => void;
};

const BR001_QuestionLengthRule: BusinessRule<string> = {
  id: 'BR001',
  description: 'å•é¡Œæ–‡ã¯500æ–‡å­—ä»¥å†…',
  validate: (question: string) => {
    return question.length <= 500 
      ? ValidationResult.success() 
      : ValidationResult.error('å•é¡Œæ–‡ã¯500æ–‡å­—ä»¥å†…ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™');
  }
};

// ãƒ«ãƒ¼ãƒ«é©ç”¨ã®å‹å®‰å…¨æ€§
class RuleEngine {
  public applyRules<T>(target: T, rules: BusinessRule<T>[]): ValidationResult {
    const results = rules.map(rule => rule.validate(target));
    return ValidationResult.combine(results);
  }
}
```

#### ä¸å¤‰æ¡ä»¶ã®å®Ÿè£…

```typescript
// é›†ç´„ã§ã®ä¸å¤‰æ¡ä»¶ä¿è¨¼
abstract class AggregateRoot {
  protected invariants: InvariantRule[] = [];
  
  protected checkInvariants(): void {
    for (const invariant of this.invariants) {
      const result = invariant.check(this);
      if (!result.isSatisfied()) {
        throw new InvariantViolationError(invariant.description, result.violation);
      }
    }
  }
  
  protected addInvariant(invariant: InvariantRule): void {
    this.invariants.push(invariant);
  }
}

class QuizAggregate extends AggregateRoot {
  constructor() {
    super();
    
    // BR004, BR012ã®ä¸å¤‰æ¡ä»¶ã‚’ç™»éŒ²
    this.addInvariant(new ApprovalInvariant());
    this.addInvariant(new AnswerabilityInvariant());
  }
  
  public changeStatus(newStatus: QuizStatus): void {
    const oldStatus = this.status;
    this.status = newStatus;
    
    try {
      this.checkInvariants(); // ä¸å¤‰æ¡ä»¶ãƒã‚§ãƒƒã‚¯
    } catch (error) {
      this.status = oldStatus; // ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
      throw error;
    }
  }
}
```

```

## åˆ©ç‚¹ãƒ»æ¬ ç‚¹

### åˆ©ç‚¹
- âœ… **ãƒ“ã‚¸ãƒã‚¹é‡è¦–**: ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒè¨­è¨ˆã®ä¸­å¿ƒ
- âœ… **æ•´åˆæ€§ä¿è¨¼**: ãƒ«ãƒ¼ãƒ«é•åã®æ—©æœŸæ¤œå‡ºãƒ»é˜²æ­¢
- âœ… **ä¿å®ˆæ€§**: ãƒ«ãƒ¼ãƒ«å¤‰æ›´æ™‚ã®å½±éŸ¿ç¯„å›²æ˜ç¢º
- âœ… **ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£**: ãƒ«ãƒ¼ãƒ«å˜ä½ã§ã®ãƒ†ã‚¹ãƒˆè¨­è¨ˆ
- âœ… **ç›£æŸ»æ€§**: ãƒ«ãƒ¼ãƒ«å®Ÿè¡Œå±¥æ­´ã®è¿½è·¡

### æ¬ ç‚¹
- âŒ **è¤‡é›‘æ€§**: ãƒ«ãƒ¼ãƒ«é–“é–¢ä¿‚ã®è¤‡é›‘åŒ–
- âŒ **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒ«ãƒ¼ãƒ«æ¤œè¨¼ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰
- âŒ **éåº¦è¨­è¨ˆ**: ç°¡å˜ãªãƒ«ãƒ¼ãƒ«ã®éåº¦ãªæŠ½è±¡åŒ–
- âŒ **ãƒ«ãƒ¼ãƒ«ç«¶åˆ**: çŸ›ç›¾ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã®èª¿æ•´å›°é›£

## é©ç”¨å ´é¢
- ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãŒè¤‡é›‘ãƒ»é »ç¹ã«å¤‰æ›´ã•ã‚Œã‚‹å ´åˆ
- ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ»ç›£æŸ»è¦ä»¶ãŒå³ã—ã„å ´åˆ
- ãƒ‡ãƒ¼ã‚¿å“è³ªãƒ»æ•´åˆæ€§ãŒæœ€é‡è¦ãªå ´åˆ
- ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚·ã‚¹ãƒ†ãƒ ãƒ»ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ 
- è¦åˆ¶ãŒå³ã—ã„æ¥­ç•Œï¼ˆé‡‘èãƒ»åŒ»ç™‚ãƒ»æ³•å¾‹ç­‰ï¼‰
