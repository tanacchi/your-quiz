# DDD運用可能な厳密仕様化のためのドメイン知識理解ドキュメント作成プロンプト（案1・2・5統合完全版）

あなたはドメイン駆動設計（DDD）に精通したエンジニアです。すでに仕様や技術スタックがざっくり決まっている状態から、DDDで運用可能なレベルの厳密な仕様書を作成するため、下記の方法とフォーマットで**ドメイン知識理解ドキュメント**を構築してください。

---

## 【全体進行方針（案5: 質問駆動反復＋段階進化）】

- 初期分析→質問生成→回答→理解更新を**複数サイクル反復**し、理解度を段階的に高めていく。
- 各サイクルで**進捗・理解度・残存疑問・新規発見**を明記し、**仕様の厳密化とトレーサビリティ**を両立する。
- サイクルごとにナレッジ（現状理解）と質問事項（未解決点）を必ず分離する。
- 完了条件は**主要ドメイン概念の理解度80%以上**。

---

## 【出力構成・各パートの詳細】

### 1. 情報源一覧と分析順序（案1/5より）

- 仕様・技術スタック・要件等の情報源一覧をリストアップし、優先度・読み順を明記。
- 各ドキュメントの読了状況・抽出概念数・疑問点数も追記。

#### フォーマット例

| ドキュメント   | 読了状況 | 抽出概念数 | 疑問点数 | 備考     |
| -------- | ---- | ----- | ---- | ------ |
| [ファイルパス] | ✅/⏳  | [数]   | [数]  | [追加情報] |

---

### 2. 概念理解マトリックス（案2ベース、案1・5要素追加）

- 仕様書から抽出した**主要ドメイン概念**ごとに、エビデンス・ビジネスルール・用語定義・理解度・質問・現状解釈・進捗コメント等を一覧で管理。

#### フォーマット例

| 概念   | エビデンス          | ビジネスルール | 用語定義(日/英)     | 理解度 | 残存質問   | 現状解釈・進捗コメント  |
| ---- | -------------- | ------- | ------------- | --- | ------ | ------------ |
| Quiz | user-story#L15 | 管理者承認必須 | ◯×形式問題 / Quiz | 80% | 承認基準は？ | 初期抽出のみ、定義要補強 |

---

### 3. ビジネスルール詳細マトリックス（案2/1要素）

- ビジネスルールや仕様制約、例外、実装影響、不明点を整理。

#### フォーマット例

| ルール名    | エビデンス            | 制約条件  | 例外条件 | 実装影響    | 不明点・質問   |
| ------- | ---------------- | ----- | ---- | ------- | -------- |
| クイズ承認必須 | requirements#L45 | 管理者のみ | なし   | 承認フロー実装 | 承認基準の具体化 |

---

### 4. 用語統一マトリックス（ユビキタス言語候補）

- ドメイン共通語の厳密な定義、用法例、BDD表現例を日英で記載。

#### フォーマット例

| 日本語 | 英語   | エビデンス          | 定義   | 用法例    | BDD表現例       |
| --- | ---- | -------------- | ---- | ------ | ------------ |
| クイズ | Quiz | user-story#L15 | ◯×問題 | クイズを作成 | Given クイズが存在 |

---

### 5. 理解進捗・サイクル管理（案1/5統合）

- 各サイクル（Iteration）での進捗・理解度更新・残存疑問・新規発見を管理。
- 理解度マトリックスは主要概念ごとに%で表現し、サイクル毎に履歴管理。
- サイクルごとに「新規発見」「理解度の変化」「残存・新規疑問」などを箇条書き。

#### フォーマット例

```markdown
## Iteration N: [日時 or テーマ]
- 分析対象: [ドキュメント/仕様]
- 発見概念: [リスト]
- 解決した質問: [リスト]
- 新規/残存疑問: [リスト]
- 概念ごとの理解度マトリクス更新
- 進捗コメント
```

---

### 6. 質問事項マトリックス（案2/5ベース）

- ドメインエキスパート・開発チーム・ステークホルダーに対する**具体的質問事項**をカテゴリ・緊急度順で管理。
- 質問には背景や選択肢、なぜ必要かの理由も明記。

#### フォーマット例

| カテゴリ    | 対象    | 質問     | 緊急度 | 選択肢        | 背景・理由        |
| ------- | ----- | ------ | --- | ---------- | ------------ |
| ビジネスルール | クイズ承認 | 承認基準は？ | 高   | 内容のみ/重複+内容 | 承認必須とあるが詳細不明 |

---

### 7. ユビキタス言語辞書（成果物リンク）

- 進捗サイクルで確立されたユビキタス言語を、日英対訳・定義・BDD表現例付きでまとめる。

#### フォーマット例

| 日本語 | 英語   | 定義                    | エビデンス                   | BDD表現             |
| --- | ---- | --------------------- | ----------------------- | ----------------- |
| クイズ | Quiz | 問題文・正解・解説・承認状態を持つ◯×問題 | user-story#L15, req#L22 | Given クイズが承認済みである |

---

## 【作成・運用上のポイント】

- 各パートのフォーマットは上記テンプレートを流用、情報が増えれば逐次追記・更新
- 曖昧・未解決・要調査事項は**そのまま残し、「未確定」「要追記」等の明示タグを付与**
- 情報源（ファイル/URL/議事録等）はできる限りリンク付きで記載
- サイクル（Iteration）単位で履歴を追記し、知識進化の経緯を残す
- 進捗・理解度・質問は常に明示的に記録する
- 最終成果物として、**厳密なユビキタス言語辞書・ビジネスルール確定版・未解決事項リスト**を必ず残す

---

## 【出力例】

### 情報源一覧

| ドキュメント                            | 読了状況 | 抽出概念数 | 疑問点数 |
| --------------------------------- | ---- | ----- | ---- |
| user-stories/user-story-quiz.md   | ✅    | 8     | 2    |
| requirements/requirements-quiz.md | ✅    | 12    | 4    |

### 概念理解マトリックス

| 概念   | エビデンス          | ビジネスルール | 用語定義(日/英)   | 理解度 | 質問     | 現状解釈    |
| ---- | -------------- | ------- | ----------- | --- | ------ | ------- |
| Quiz | user-story#L15 | 承認フロー必須 | ◯×形式問題/Quiz | 80% | 承認基準は？ | 主要仕様は判明 |

### ビジネスルール詳細

| ルール名    | エビデンス            | 制約    | 例外 | 実装影響    | 不明点      |
| ------- | ---------------- | ----- | -- | ------- | -------- |
| クイズ承認必須 | requirements#L45 | 管理者のみ | なし | 承認フロー実装 | 承認基準の具体化 |

### 用語統一マトリックス

| 日本語 | 英語   | エビデンス          | 定義   | 用法例    | BDD表現例       |
| --- | ---- | -------------- | ---- | ------ | ------------ |
| クイズ | Quiz | user-story#L15 | ◯×問題 | クイズを作成 | Given クイズが存在 |

### 理解進捗・サイクル例

```markdown
## Iteration 1: 初期概念抽出
- 分析対象: user-stories, requirements
- 発見概念: Quiz, Creator
- 新規疑問: 承認基準, 匿名識別
- 概念理解度: Quiz(60%), Creator(40%)

## Iteration 2: 追加仕様深掘り
- 分析対象: requirements
- 解決した質問: 匿名識別方式(saltハッシュ)
- 新規疑問: 承認基準の詳細
- 概念理解度: Quiz(80%), Creator(80%)
```

### 質問事項マトリックス

| カテゴリ    | 対象    | 質問     | 緊急度 | 選択肢        | 背景・理由        |
| ------- | ----- | ------ | --- | ---------- | ------------ |
| ビジネスルール | クイズ承認 | 承認基準は？ | 高   | 内容のみ/重複+内容 | 承認必須とあるが詳細不明 |

### ユビキタス言語辞書

| 日本語 | 英語   | 定義                    | エビデンス                   | BDD表現             |
| --- | ---- | --------------------- | ----------------------- | ----------------- |
| クイズ | Quiz | 問題文・正解・解説・承認状態を持つ◯×問題 | user-story#L15, req#L22 | Given クイズが承認済みである |

---

## 【推奨サイクルと運用方法】

- まず情報源分析→概念・ルール・用語・質問の抽出
- サイクルごとにナレッジ（現状理解）と質問（未解決点）を分離
- 理解度・進捗・質問の履歴を逐次記録
- 主要概念の理解度が十分に高まった段階で仕様書・用語辞書としてFIX
- 以降も追加・変更に柔軟に追従できる構造とする

