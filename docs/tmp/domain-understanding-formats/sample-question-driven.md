# 実例: 質問駆動反復型 - クイズアプリケーション

## 反復サイクル概要
- **サイクル期間**: 各1-2時間
- **1サイクル構成**: specifications分析 → 質問生成 → 回答 → 理解度更新
- **完了条件**: 核心概念（Quiz, Creator, Approval等）の理解度80%以上
- **情報源**: docs/project/specifications/

---

## 🔄 Iteration 1: 初期concepts発見 (9:00-10:30)

### 📖 分析対象
- **主要**: user-stories/user-story-quiz.md
- **補助**: requirements/requirements-quiz.md (概要のみ)

### 💡 発見概念
| 概念 | 初期理解 | エビデンス | 信頼度 |
|------|----------|------------|--------|
| **Quiz** | ◯×形式の問題 | user-story-quiz.md#L11 | 60% |
| **Anonymous User** | ログイン不要のユーザー | user-story-quiz.md#L5 | 70% |
| **Administrator** | クイズの追加・編集・削除権限を持つ | user-story-quiz.md#L6 | 80% |
| **Tag** | 分類用ラベル、複数設定可 | user-story-quiz.md#L12 | 50% |
| **Mobile Browser** | スマートフォンWebブラウザ | user-story-quiz.md#L23 | 90% |

### ❓ 生成質問（優先度順）
1. **Quiz構成詳細** [高]
   - Quizの必須・任意項目は？実際の制限は？
   - 推定: 問題文(必須・500文字)、正解(必須)、解説(任意・1000文字)、タグ(任意)
   
2. **Administrator権限範囲** [高]
   - 管理者の具体的な権限範囲は？一般ユーザーは本当に作成不可？
   - 推定: 管理者のみ作成可能、一般ユーザーは回答のみ

3. **Tag管理方式** [中]
   - タグの入力形式・管理方法は？
   - 推定: 自由入力、半角全角英数字日本語対応

### 🔄 理解更新
- **Quiz**: ◯×問題として確定、詳細構成要確認
- **Anonymous User**: ログイン不要確定、権限範囲要確認
- **Administrator**: 管理者権限確定、詳細権限要確認

---

## 🔄 Iteration 2: ビジネスルール深掘り (10:45-12:15)

### 🔄 前回からの継続
- Quiz構成詳細の調査 → requirements-quiz.md#L10-L16で詳細発見
- Administrator権限 → 実は承認フローで一般ユーザーも作成可能と判明

### 📖 新規分析対象
- **主要**: requirements/requirements-quiz.md (全文)
- **補助**: success-scenarios/success-quiz.md#L26-L46

### 🎯 解決済み質問
- ✅ **Quiz構成**: 問題文(必須・500文字)、正解(◯×)、解説(任意・1000文字)、タグ(任意・複数)
- ✅ **Administrator権限**: 管理者は承認権限、一般ユーザーも作成可能だが承認待ち

### 💡 新規発見概念
| 概念 | 理解 | エビデンス | 信頼度 |
|------|------|------------|--------|
| **Approval Flow** | 投稿後の管理者承認プロセス | requirements-quiz.md#L20 | 90% |
| **Creator Identification** | salt付きハッシュによる作成者識別 | requirements-quiz.md#L22 | 80% |
| **XSS Protection** | HTMLタグサニタイズ処理 | requirements-quiz.md#L16 | 85% |
| **Duplicate Posting** | 同一ユーザー・同一問題でも投稿可 | requirements-quiz.md#L15 | 90% |

### ❓ 新規生成質問
4. **Approval基準詳細** [高]
   - 承認の具体的判定基準は？期間制限は？
   - 現状: 初期段階はDB直接操作、将来的に管理画面

5. **Creator識別詳細** [中]
   - salt付きハッシュの具体的仕様は？デバイス変更時は？
   - 現状: ブラウザ上での作成者判定、詳細仕様不明

6. **重複投稿の意図** [低]
   - なぜ重複投稿を許可するのか？ビジネス上の理由は？
   - 現状: 同一問題でも個別に承認される想定

### 🔄 理解更新
- **Quiz**: 承認フロー付きの◯×問題、作成者はsalt付きハッシュで識別
- **Administrator**: 承認権限のみ、クイズ作成は一般ユーザーも可能
- **Approval Flow**: 投稿即時公開なし、管理者承認後公開

---

## 🔄 Iteration 3: UI・UX詳細分析 (13:00-14:30)

### 📖 分析対象
- **主要**: success-scenarios/success-quiz.md
- **補助**: requirements/requirements-quiz.md#L38-L44

### 🎯 解決済み質問
- ✅ **Approval基準**: 初期段階はDB直接操作、明確な基準は未定義
- ✅ **Creator識別**: ブラウザでsalt付きハッシュ保存、詳細仕様は実装時決定

### 💡 UI/UX理解
| 要素 | 詳細仕様 | エビデンス | 信頼度 |
|------|----------|------------|--------|
| **Tinder UI** | 右スワイプ=◯、左スワイプ=× | requirements-quiz.md#L41 | 95% |
| **Result Display** | 正誤判定バン表示→フェードアウト→解説 | requirements-quiz.md#L42 | 95% |
| **Answer History** | indexedDBに問題文・解答日時保存 | success-quiz.md#L24, L62 | 90% |
| **Offline Mode** | 事前ダウンロード+同期処理 | success-quiz.md#L66-L84 | 80% |

### 🔍 新規発見要素
| 要素 | 理解 | エビデンス | 信頼度 |
|------|------|------------|--------|
| **Tag Filtering** | タグによるクイズ絞り込み機能 | success-quiz.md#L13 | 90% |
| **Re-answer** | 同じ問題の再解答機能 | success-quiz.md#L64 | 85% |
| **Network Error** | 通信失敗時のオフラインモード提案 | success-quiz.md#L76 | 90% |

### ❓ 新規生成質問
7. **Offline Data Range** [中]
   - 事前ダウンロードするデータの範囲は？全クイズ？
   - 現状: 「事前ダウンロード済み」との記載のみ

8. **Sync Timing** [低]
   - オンライン復旧時の同期タイミングは？自動？手動？
   - 現状: 「ネットワーク復旧時に同期処理」との記載のみ

---

## 🔄 Iteration 4: ユビキタス言語確立 (15:00-16:00)

### 📝 確定用語辞書
| 日本語 | 英語 | 定義 | エビデンス | BDD表現 |
|--------|------|------|------------|---------|
| **クイズ** | Quiz | 問題文・正解・解説・タグ・承認状態を持つ◯×問題 | user-story#L11<br>req#L10-L16 | Given クイズが承認済みである |
| **作成者** | Creator | salt付きハッシュで識別される匿名投稿者 | req#L22<br>success#L45 | Given 作成者が存在する |
| **承認** | Approval | 管理者による投稿クイズの公開可否判定 | req#L20<br>success#L43 | When 管理者がクイズを承認する |
| **回答** | Answer | Tinder UI(スワイプ)による◯×選択とindexedDB履歴 | req#L41<br>success#L15 | When ユーザーが右スワイプする |
| **タグ** | Tag | クイズ分類用の日本語・英数字ラベル | user-story#L12<br>success#L13 | Given タグでクイズを絞り込む |

### 🔄 表現統一ルール
- **動詞**: 「投稿する」「承認する」「回答する」「同期する」「絞り込む」
- **状態**: 「承認待ち」「承認済み」「オフライン」「同期中」
- **UI**: 「右スワイプ」「左スワイプ」「バン表示」「フェードアウト」

### 📊 最終理解度
| 概念 | 最終理解度 | 確信度 | 実装可能性 |
|------|------------|--------|------------|
| Quiz | 95% | 高 | ✅ |
| Creator | 80% | 中 | ✅ |
| Approval | 75% | 中 | ✅ |
| Answer | 90% | 高 | ✅ |
| Tag | 85% | 中 | ✅ |
| Offline | 70% | 中 | 🔶 |

---

## 📝 最終成果物

### ✅ 確定ユビキタス言語
```markdown
# ユビキタス言語辞書 v1.0

## 核心概念
- **Quiz**: 問題文(500文字以内)・正解(◯×)・解説(1000文字以内)・タグ(複数)・承認状態を持つ学習問題
- **Creator**: salt付きハッシュでブラウザ識別される匿名のクイズ投稿者  
- **Approval**: 管理者による投稿クイズの公開可否判定プロセス（初期段階はDB直接操作）
- **Answer**: Tinder UI（右スワイプ=◯、左スワイプ=×）による選択とindexedDB永続化履歴
- **Tag**: 日本語・英数字対応のクイズ分類ラベル、絞り込み検索で使用

## 統一表現
- 動詞: 投稿・承認・回答・同期・絞り込み
- 状態: 承認待ち・承認済み・オフライン・同期中
- UI: 右スワイプ・左スワイプ・バン表示・フェードアウト
```

### ✅ ビジネスルール確定版
1. **承認必須**: 全投稿クイズは管理者承認後のみ公開（初期段階はDB直接操作）
2. **匿名識別**: Creatorはsalt付きハッシュでブラウザ識別、ログイン不要
3. **重複許可**: 同一Creator・同一問題でも個別投稿・個別承認可能
4. **履歴永続化**: 回答履歴はindexedDBに永続保存（問題文・解答日時）
5. **XSS対策**: 問題文・解説・タグのHTMLタグはサニタイズ処理
6. **モバイル専用**: スマートフォンWebブラウザのみ対応、PC未対応

### ❓ 未解決事項（実装時決定）
- salt付きハッシュの具体的アルゴリズム（SHA-256+ランダムsalt推奨）
- 承認の具体的基準（内容適切性・重複チェック等）
- オフライン時の事前ダウンロード範囲（全データ or 一部）
- 同期処理の詳細タイミング（自動 or 手動トリガー）

### 📋 問い合わせテンプレート準拠
```markdown
# DDD設計 - 問い合わせ

## Q1: 承認基準の明文化
requirements-quiz.md#L20で管理者承認が必要とありますが、具体的な判定基準をお教えください。
- A) 内容適切性のみチェック
- B) 重複チェック + 内容適切性チェック  
- C) その他の基準（法的チェック等）

## Q2: salt付きハッシュの仕様
requirements-quiz.md#L22でsalt付きハッシュとありますが、実装仕様をお教えください。
- A) SHA-256 + ランダムsalt
- B) bcrypt使用
- C) その他のハッシュ方式

## Q3: オフライン事前ダウンロード範囲
success-quiz.md#L70で事前ダウンロードとありますが、対象データ範囲をお教えください。
- A) 全承認済みクイズ
- B) 人気・新着のサブセット
- C) ユーザー選択によるカスタム範囲
```

---

## 📊 成果サマリー

### ✅ 達成事項
- 主要概念5個の完全特定・理解（Quiz, Creator, Approval, Answer, Tag）
- ビジネスルール6個の明確化
- ユビキタス言語22語の定義確定
- 実装レベル理解4/5概念で達成

### 📈 理解度向上
| 概念 | 開始時 | 終了時 | 向上 |
|------|--------|--------|------|
| Quiz | 30% | 95% | +65% |
| Creator | 10% | 80% | +70% |
| Approval | 0% | 75% | +75% |
| Answer | 20% | 90% | +70% |
| Tag | 30% | 85% | +55% |

### 🎯 実装準備完了度
- **UI実装**: 95%（Tinder UI、結果表示、履歴管理仕様確定）
- **バックエンド実装**: 85%（承認フロー、salt識別仕様80%確定）
- **オフライン機能**: 70%（基本方針確定、詳細仕様要確認）